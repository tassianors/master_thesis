% ===============================================================================
\section{Virtual reference feedback tuning}
\label{sec:dbcd_vrft}
% ===============================================================================

VRFT do inglês {\it{Virtual reference feedback tuning}} é um método direto para identificação de
controladores, ou seja, não é necessário o conhecimento ou identificação da planta para que este método seja
utilizado. O método baseia-se na utilização de apenas um conjunto de dados, não necessitando de experimentos
específicos. O procedimento procura pelo ponto ótimo do critério escolhido para a identificação do controlador.
\cite{campi_savaresi2000}

Diferentemente de métodos iterativos, o VRFT não recai sobre mínimos locais, sempre procurando o mínimo
global do critério escolhido, sob condições ideais:

\begin{itemize}
  \item O sistema não é afetado por ruído, ou seja, $\sigma_e^2(t)=0$.
  \item O controlador ideal $C_d(q) \in C(q, \theta)$.
  \item O controlador é parametrizado linearmente. 
\end{itemize}

O controlador a ser identificado pode ser parametrizado como abaixo:

\begin{equation}
C(q,\theta)=\beta^T(q)\theta
\label{eq:vrft_method_controller}
\end{equation}
onde $\beta(q) = \left [ \beta_1(q)\;\; \beta_2(q)\;\; \cdots \;\; \beta_n(q)\right ]^T$ é um vetor
linear de funções de transferências de tempo discreto e $\theta$ é o vetor de parâmetros a ser estimado.

O problema de identificação do controlador consiste em encontrar um $\hat{\theta}$ que minimize o
critério performance \eqref{eq:dbcd_def_track_error}, replicado abaixo:

\begin{equation}
J_y(\theta)\overset{\underset{\mathrm{\Delta}}{\,}}{=}  \bar{E} \left [ y(t)-y_d(t) \right ]^2 = \bar{E}\left [
(T(q,\theta)-T_d(q))r(t) \right ]^2
\nonumber
\end{equation}
que é dependente do modelo de referência escolhido. 

Apenas alguns métodos genuinamente diretos são encontrados na literatura, dois destes são VRFT e IFT ({\it{Iterative
Feedback Tuning}}). Mesmo estes dois métodos pertencendo a uma mesma classe, algumas diferenças significativas existem e podem ser ressaltadas:
\cite{campi_savaresi2000}

\begin{itemize}
	\item {\it{IFT}} é um técnica iterativa. Usualmente este método converge para o mínimo local mais próximo das
	condições iniciais. Ele requer experimentos específicos sobre a planta, com entradas específicas.
	\item {\it{VRFT}} é um procedimento não iterativo que procura pelo mínimo global do critério de
	performance \eqref{eq:dbcd_def_track_error}. Este método não requer experimentos específicos sobre
	a planta, podendo inclusive utilizar os dados do funcionamento normal do sistema.
\end{itemize}

%===============================================================================
\subsection{O método}
\label{sec:dbcd_vrft_framework}
%===============================================================================

Nesta seção será apresentada uma breve descrição de como funciona o algoritmo para obtenção do controlador
utilizando o método VRFT. Para maiores detalhes e discussões aprofundadas é indicada a leitura de
\cite{campi_savaresi2000, campi_leccini_savaresi2002, campestrini_nonminumum_phase, bazanella_datadriven}.

Baseado no sinal medido $y(t)$, considera-se um sinal $\bar{r}(t)$ tal que $T_d(q)\bar{r}(t)=y(t)$.
Esta referência é conhecida como {\it{virtual}} pois ela não existe e não foi utilizada para gerar o
sinal $y(t)$. A Figura \ref{fig:vrft_method_cl} apresenta o sistema em malha fechada e os sinais
presentes.

\begin{figure}[htbp]
\center
%\scalebox{1} % Change this value to rescale the drawing.
%{
\begin{pspicture}(0,-1.4292188)(9.02,1.4692187)
\pscircle[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](1.4,0.97078127){0.2}
\psframe[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](4.8,1.3707813)(3.0,0.57078123)
\psframe[linewidth=0.04,dimen=outer](7.6,1.3707813)(6.0,0.57078123)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(0.0,0.97078127)(1.2,0.97078127)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(1.6,0.97078127)(3.0,0.97078127)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(4.8,0.97078127)(6.0,0.97078127)
\psline[linewidth=0.04cm](7.6,0.97078127)(9.0,0.97078127)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{<-}(1.4,0.7707813)(1.4,-0.02921875)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm](1.4,-0.02921875)(8.4,-0.02921875)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm](8.4,-0.02921875)(8.4,0.97078127)
\usefont{T1}{ptm}{m}{n}
\rput(1.1126562,1.2807813){+}
\usefont{T1}{ptm}{m}{n}
\rput(1.6473438,0.68078125){-}
\usefont{T1}{ptm}{m}{n}
\rput(0.47,1.2707813){\small $\bar{r}(t)$}
\usefont{T1}{ptm}{m}{n}
\rput(3.99,0.97078127){\small $C(q, \theta)$}
\usefont{T1}{ptm}{m}{n}
\rput(6.76,0.9507812){\small $G_0(q)$}
\usefont{T1}{ptm}{m}{n}
\rput(5.51,1.2707813){\small $u(t)$}
\usefont{T1}{ptm}{m}{n}
\rput(2.25,1.2707813){\small $\epsilon (t)$}
\usefont{T1}{ptm}{m}{n}
\rput(8.3,1.2707813){\small $y(t)$}
\psframe[linewidth=0.04,dimen=outer](6.0,-0.62921876)(3.8,-1.4292188)
\usefont{T1}{ptm}{m}{n}
\rput(4.91,-1.0492188){\small $T_d^{-1}(q)$}
\psline[linewidth=0.04cm](9.0,0.97078127)(9.0,-1.0292188)
\psline[linewidth=0.04cm](9.0,-1.0292188)(6.0,-1.0292188)
\psline[linewidth=0.04cm](3.8,-1.0292188)(0.0,-1.0292188)
\psline[linewidth=0.04cm](0.0,-1.0292188)(0.0,0.97078127)
\end{pspicture} 
%}
\caption{Diagrama de blocos para o método VRFT. São destacados os sinais reais $u(t)$ e $y(t)$ além dos sinais virtuais
$\epsilon (t)$ e $\bar{r}(t)$. Em pontilhado está o controlador que quando aplicado sobre a malha, faz com que o
sistema se comporte como desejado: $T_d(q)$.}
\label{fig:vrft_method_cl}
\end{figure}

O sinal $\epsilon(t)$ é o erro entre os sinais $y(t)$ e $\bar{r}(t)$. Sabe-se que quando a planta é
excitada com o sinal $u(t)$, o sinal $y(t)$ é obtido. Analogamente para um controlador, quando este é
excitado com o sinal $\epsilon(t)$, o sinal $u(t)$ é obtido. A tarefa do método VRFT é encontrar este
controlador, com os sinais $u(t)$ e $\epsilon(t)$ que são conhecidos, a tarefa reduz-se a um problema de
identificação. Comumente, usa-se um pré-filtro nos dados coletados. A ideia principal do uso deste
filtro será explicada posteriormente na Seção \ref{sec:dbcd_vrft_framework_filter}. 

O algoritmo pode ser descrito pelos passos a seguir \cite{campi_savaresi2000}:

\begin{enumerate}
	\item Filtram-se os sinais de entrada e saída com algum filtro $L(q)$:

\begin{equation}
y_L (t)=L(q)y(t), \;\;\; u_L (t)=L(q)u(t) 
\label{eq:vrft_method_algorithm_filter_io}
\end{equation}

\begin{equation}
\epsilon_L (t)=L(q)\epsilon (t)=\bar{r}_L (t)-y_L (t) 
\nonumber
\end{equation}


\item Encontra-se um sinal de referência $\bar{r}_L (t)$ no qual a saída do modelo de referência
$T_d(q)$ seja exatamente $y_L (t)$ quando alimentado pelo sinal:

\begin{equation}
y_L (t)=T_d(q) \bar{r}_L (t)
\label{eq:vrft_method_algorithm_ref}
\end{equation}

\item Seleciona-se o vetor de parâmetros do controlador $\hat{\theta}$ que minimize o critério:

\begin{equation}
J_{VR}^N(\theta)=\frac{1}{N}\sum_{t=1}^{N}(u_L(t)-\varphi_L^T(t)\theta)^2
\label{eq:vrft_method_algorithm_criter}
\end{equation}

\begin{equation}
\varphi_L(t)=\beta(q)\epsilon_L(t)
\nonumber
\end{equation}

Desde que \eqref{eq:vrft_method_algorithm_criter} seja quadrática em $\theta$ o vetor de parâmetros
$\hat{\theta}$ que minimiza esta função custo pode ser calculado por:

\begin{equation}
\hat{\theta}= \left [ \sum_{t=1}^{N}\varphi_L(t) \varphi_L(t)^T\right ]^{-1}
\sum_{t=1}^{N}\varphi_L(t) u_L(t)
\label{eq:vrft_method_algorithm_result}
\end{equation}

\end{enumerate}

Com o intuito de exemplificar, na Figura \ref{fig:vrft_cost_functions} é apresentadqa uma curva da função custo
$J_y(\theta)$ de um sistema hipotético, e a função custo proposta pelo método VRFT $J_{VR}(\theta)$, a qual é quadrática em $\theta$.
Ao tentar encontrar o ponto de mínimo da curva $J_y(\theta)$ pode-se recair em algum mínimo local, o que não acontece 
para a curva  $J_{VR}(\theta)$.

\begin{figure}[htbp]
\center
% Generated with LaTeXDraw 2.0.8
% Mon Jul 02 22:05:15 BRT 2012
% \usepackage[usenames,dvipsnames]{pstricks}
% \usepackage{epsfig}
% \usepackage{pst-grad} % For gradients
% \usepackage{pst-plot} % For axes
\scalebox{0.75} % Change this value to rescale the drawing.
{
\begin{pspicture}(0,-4.62)(11.799063,4.62)
\psbezier[linewidth=0.04](0.9,3.3)(2.1,3.2)(2.0225368,2.3742967)(2.1565964,1.5166456)(2.290656,0.6589943)(2.616248,-1.3127834)(3.008854,-0.5402044)(3.4014597,0.23237456)(3.6584003,0.8693678)(3.811938,0.20167358)(3.9654756,-0.4660206)(4.5199084,-3.4794219)(5.1017394,-3.533306)(5.68357,-3.5871902)(8.0,1.8)(9.5,3.2)
\psbezier[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm](0.4,2.2)(2.2,-2.6)(3.960841,-3.4989967)(5.12,-3.54)(6.279159,-3.5810034)(9.3,-1.9)(10.6,1.9)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 4.0,arrowlength=1.4,arrowinset=0.4]{<-}(1.1,4.6)(1.2,-4.6)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 4.0,arrowlength=1.4,arrowinset=0.4]{->}(0.0,-3.9)(11.3,-3.9)
\psline[linewidth=0.04cm,linestyle=dotted,dotsep=0.16cm](5.1,-4.0)(5.0,3.1)
\usefont{T1}{ppl}{m}{n}
\rput(5.114531,-4.19){$\theta^*$}
\usefont{T1}{ppl}{m}{n}
\rput(11.014531,-4.19){$\theta$}
\usefont{T1}{ppl}{m}{n}
\rput(0.5545313,4.01){$J(\theta)$}
\usefont{T1}{ppl}{m}{n}
\rput(2.5545313,2.71){$J_y$}
\usefont{T1}{ppl}{m}{n}
\rput(3.2145312,-1.79){$J_{VR}$}
\end{pspicture} 
}
\caption{Gráfico da função custo de algum sistema hipotético e a respectiva função custo proposta pelo método VRFT que é
mais simples de encontrar o ponto de mínimo pois é quadrática em $\theta$, não recaindo em mínimos locais. O valor
$\theta^*$ é o ponto de mínimo de ambas as funções custo, logo, minimizando a função custo $J_{VR}(\theta)$ é o
equivalente a minimizar $J_y(\theta)$ sob condições ideais.}
\label{fig:vrft_cost_functions}
\end{figure}

%===============================================================================
\subsection{Utilização do Filtro $L(q)$}
\label{sec:dbcd_vrft_framework_filter}
%===============================================================================

Considerando a função custo $J_{y}(\theta)$ apresentada em \eqref{eq:dbcd_def_track_error} e o
critério do método de referência virtual $J_{VR}(\theta)$ apresentado em \eqref{eq:vrft_method_algorithm_criter} serem
diferentes fora de situações ideais. A escolha correta do filtro $L(q)$ propicia que estas duas equações tenham mínimos
muito próximos \cite{campi_leccini_savaresi2002}.

A utilização do filtro é de grande importância em situações onde a escolha do modelo $C(q,\theta)$ não consegue
representar exatamente o controlador ótimo ($C_d(q)$), ou seja:

\begin{equation}
C_d(q) \notin \mathcal{C}
\nonumber
\end{equation}

Aplicando o teorema de Parseval a função custo de seguimento de referência:

\begin{equation}
J_y(\theta)=\bar{E}\left [ (T(q,\theta)-T_d(q))r(t) \right ]^2
\nonumber
\end{equation}
e usando as relações de malha fechada:

\begin{equation}
T_d(q)=\frac{C_d(q)G_0(q)}{1+C_d(q)G_0(q)}\;\;\;\; T(q, \theta)=\frac{C(q, \theta)G_0(q)}{1+C(q, \theta)G_0(q)}
\nonumber
\end{equation}

Obtém-se a seguinte expressão no domínio da frequência para a função custo:

\begin{equation}
J_y(\theta)=\frac{1}{2\pi}\int_{-\pi}^{\pi}\left | \frac{G_0(e^{j\omega})C(e^{j\omega},
\theta)}{1+G_0(e^{j\omega})C(e^{j\omega},\theta)}-\frac{G_0(e^{j\omega})C_d(e^{j\omega})}{1+G_0(e^{j\omega})C_d(e^{j\omega})} \right |^2 \Phi_r(e^{j\omega})d\omega
\nonumber
\end{equation}

Desenvolvendo esta expressão, pode-se descrevê-la mais compactamente como:

\begin{eqnarray}\nonumber
J_y(\theta)&=&\frac{1}{2\pi}\int_{-\pi}^{\pi}\left | G_0(e^{j\omega}) \right |^2 \left | S(e^{j\omega},\theta) \right |^2\left | S_d(e^{j\omega}) \right |^2 \\
&&  \times \left | C(e^{j\omega},\theta)-C_d(e^{j\omega}) \right |^2 \Phi_r(e^{j\omega})d\omega
\label{eq:dbcd_vrft_jy_cost}
\end{eqnarray}

Adiciona-se o filtro $L(q)$ à função custo do VRFT, $J_{VR}(\theta)$:

\begin{equation}
J_{VR}(\theta)=\bar{E}\left [ L(q)(u(t)-C(q,\theta)\bar{\epsilon}(t)) \right ]^2
\nonumber
\end{equation}
e usando as relações:

\begin{equation}
1-T_d(e^{j\omega})=S_d(e^{j\omega})
\nonumber
\end{equation}
e

\begin{equation}
\frac{T_d(e^{j\omega})}{G_0(e^{j\omega})}=C_d(e^{j\omega})S_d(e^{j\omega})
\nonumber
\end{equation}
pode-se então reescrever a função custo do VRFT como :


\begin{eqnarray}\nonumber
J_{VR}(\theta)&=&\frac{1}{2\pi}\int_{-\pi}^{\pi}\left | L(e^{j\omega}) \right |^2 \frac{\left | G_0(e^{j\omega}) \right
|^2 \left | S_d(e^{j\omega}) \right |^2}{\left | T_d(e^{j\omega}) \right |^2}\\ 
 && \times \left | C_d(e^{j\omega})- C(e^{j\omega},\theta) \right |^2 \Phi_u(e^{j\omega})d\omega  
\label{eq:dbcd_vrft_jvr_cost}
\end{eqnarray}

Comparando agora \eqref{eq:dbcd_vrft_jy_cost} e \eqref{eq:dbcd_vrft_jvr_cost}, observa-se que quando $C_d(q) \in
\mathcal{C}$ as duas funções custopossuem o mesmo mínimo. Quando $C_d(q) \notin \mathcal{C}$
nenhum dos critérios desaparece e o ponto de mínimo depende de vários fatores dentro da integral. Se os fatores dentro
dos dois integrandos são diferentes, não existe motivos para esperar que os dois custos sejam os mesmos.
\cite{bazanella_datadriven}

Existe entretanto o parâmetro livre que foi incluído à função custo do VRFT que pode ser escolhido a fim de aproximar
estes dois integrandos: o filtro $L(q)$. Para fazer com que $J_{VR}(\theta)=J_y(\theta)$, é suficiente escolher
$L(e^{j\omega})$ como:

\begin{equation}
\left | L(e^{j\omega}) \right |^2=\left | T_d(e^{j\omega}) \right |^2\left | S(e^{j\omega},\theta) \right
|^2\frac{\Phi_r(e^{j\omega})}{\Phi_u(e^{j\omega})}, \;\;\;\; \forall\omega \in \left [ -\pi; \pi \right ]
\label{eq:dbcd_vrft_filter_l}
\end{equation}
onde $\Phi_r(e^{j\omega})$ representa o espectro do sinal real da referência $r(t)$ e $\Phi_u(e^{j\omega})$ representa o
espectro do sinal aplicado sobre o sistema, medido durante o experimento do VRFT.

O cálculo do filtro apresentado em \eqref{eq:dbcd_vrft_filter_l} requer do conhecimento da função $S(q,\theta)$, que
não é conhecida. Então a implementação deste filtro irá recair em alguma aproximação desta função
de transferência. Quanto melhor for a aproximação, mais próximos serão os mínimos das funções custo $J_y(\theta)$ e
$J_{VR}(\theta)$. \cite{bazanella_datadriven}

Entretanto esta não é a única escolha para a aproximação de $S(q,\theta)$; o método VRFT usa invariavelmente o seguinte:

\begin{equation}
\left | S(e^{j\omega},\theta) \right |^2\approx \left | S_d(e^{j\omega}) \right |^2=\left | 1-T_d(e^{j\omega}) \right
|^2
\label{eq:dbcd_vrft_sensible_s}
\end{equation}
o que aparenta ser uma aproximação razoável, uma vez que é esperado que as duas funções sensibilidades em
\eqref{eq:dbcd_vrft_sensible_s} sejam próximas ao redor do ponto de mínimo. Usando esta aproximação, a função de
transferência do filtro pode ser obtida por:

\begin{equation}
\left | L(e^{j\omega}) \right |^2=\left | T_d(e^{j\omega}) \right |^2\left | 1-T_d(e^{j\omega},\theta) \right
|^2\frac{\Phi_r(e^{j\omega})}{\Phi_u(e^{j\omega})}, \;\;\;\; \forall\omega \in \left [ -\pi; \pi \right ]
\label{eq:dbcd_vrft_filter_l_vrft}
\end{equation}

Para o caso onde $C_d \in C(q, \theta)$ a escolha de $L(q)$ não afeta o resultado, usualmente
escolhe-se então $L(q)=1$. \cite{campi_leccini_savaresi2002}

Com o filtro $L(q)$ calculado como em \eqref{eq:dbcd_vrft_filter_l_vrft}, o valor assintótico de $\theta$ pode ser
escrito como:

\begin{equation}
\theta_*=\bar{E}\left [ \varphi_L(t)\varphi_L(t)^T  \right ]^{-1}\bar{E}\left [ \varphi_L(t)u_L(t)  \right ]
\label{eq:dbcd_vrft_filter_estim}
\end{equation}
onde $\varphi_L(t)=L(q)\varphi(t)$ e $u_L(t)=L(q)u(t)$. O cálculo real para obter os parâmetros da estimativa é dado
por:

\begin{equation}
\theta=\left [ \sum_{t=1}^{N}\varphi_L(t)\varphi_L^T(t) \right ]^{-1} \sum_{t=1}^{N}\varphi_L(t)u_L(t)
\label{eq:dbcd_vrft_filter_estim_N}
\end{equation}
e na ausência de ruído, $\theta$ é igual ao valor de $\theta_*$ apresentado em \eqref{eq:dbcd_vrft_filter_estim}.

Na Figura \ref{fig:vrft_cost_functions_L} um exemplo hipotético é apresentado onde o valor de $\theta$ que minimiza
$J_{VR}(\theta)$ se aproxima do valor de mínimo de $J_y(\theta)$ com a utilização do filtro $L(q)$. Também observa-se que a curva de
$J_{VR}(\theta)$ quando o filtro é aplicado apresenta uma redução na sua concavidade, fazendo com que o valor de mínimo
na curva encontrado pelo algoritmo seja menos preciso, aumentando o a variância das estimativas, enquanto reduz o erro
de polarização.

\begin{figure}[htbp]
\center
% Generated with LaTeXDraw 2.0.8
% Tue Jul 03 00:08:46 BRT 2012
% \usepackage[usenames,dvipsnames]{pstricks}
% \usepackage{epsfig}
% \usepackage{pst-grad} % For gradients
% \usepackage{pst-plot} % For axes
\scalebox{0.75} % Change this value to rescale the drawing.
{
\begin{pspicture}(0,-3.97)(11.489062,3.97)
\psbezier[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm](0.59,-0.85)(1.39,-1.95)(3.950841,-2.6489966)(5.11,-2.69)(6.269159,-2.7310033)(8.69,-2.05)(9.69,-0.95)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 4.0,arrowlength=1.4,arrowinset=0.4]{<-}(1.39,3.95)(1.39,-3.95)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 4.0,arrowlength=1.4,arrowinset=0.4]{->}(0.59,-3.25)(11.09,-3.25)
\usefont{T1}{ppl}{m}{n}
\rput(10.704532,-3.54){$\theta$}
\usefont{T1}{ppl}{m}{n}
\rput(0.88453126,3.36){$J(\theta)$}
\usefont{T1}{ppl}{m}{n}
\rput(1.9445312,-0.04){$J_y$}
\usefont{T1}{ppl}{m}{n}
\rput(4.804531,1.16){$J_{VR}$}
\psbezier[linewidth=0.04](0.79,1.15)(0.79,0.35)(2.8950949,-2.049184)(3.89,-2.15)(4.884905,-2.2508159)(4.788093,-1.547449)(5.59,-0.95)(6.3919067,-0.35255104)(6.676079,-1.3078374)(7.19,-0.45)(7.7039213,0.40783736)(7.61,0.85)(8.01,1.71)(8.41,2.57)(9.09,2.89)(9.59,3.05)
\psbezier[linewidth=0.04,linestyle=dotted,dotsep=0.16cm](3.69,1.55)(4.49,0.45)(5.950841,-1.8489966)(7.11,-1.89)(8.269159,-1.9310033)(10.09,0.75)(10.99,1.85)
\usefont{T1}{ppl}{m}{n}
\rput(7.8545313,-2.54){$J_{VR}^L$}
\psdots[dotsize=0.24,dotstyle=asterisk](5.29,-2.71)
\psdots[dotsize=0.24,dotstyle=asterisk](7.15,-1.91)
\psdots[dotsize=0.24,dotstyle=asterisk](4.05,-2.17)
\end{pspicture} 
}
\caption{Exemplo hipotético de funções custo na situação onde o controlador ideal não consegue ser representado pelo
modelo. O uso do filtro $L(q)$ reduz o erro de polarização.}
\label{fig:vrft_cost_functions_L}
\end{figure}

%===============================================================================
\subsection{Dados corrompidos por ruído}
\label{sec:dbcd_vrft_framework_noise}
%===============================================================================

Nesta seção será apresentado brevemente o comportamento do método quando o sinal $y(t)$ é
corrompido por um ruído aditivo como:

\begin{equation}
\tilde{y}(t)=G_0(q)u(t) + \nu(t)
\label{eq:vrft_framework_noise_y}
\end{equation}

Assume-se que os sinais $u(t)$ e $\nu(t)$ sejam descorrelacionados e também que os dados são coletados
com a planta trabalhando em laço aberto \cite{campi_leccini_savaresi2002, lecchini}.

Ao aplicar o algoritmo descrito na Seção \ref{sec:dbcd_vrft_framework} com dados sujeitos a ruídos, o
resultado obtido possui erro de polarização. Isso pode ser compreendido analisando a expressão do critério
$J_{VR}(\theta)$ quando utiliza-se o sinal $\tilde{y}(t)$:

\begin{eqnarray}\nonumber
J_{VR}(\theta)&=&\frac{1}{2\pi} \int_{-\pi}^{\pi} \left | G_0(e^{j\omega}) \right |^2 \left |
 C(e^{j\omega},\theta)-C_d(e^{j\omega}) \right |^2 \left | 1-T_d(e^{j\omega}) \right |^2 \frac{\left | L(e^{j\omega})
 \right |^2}{\left | T_d(e^{j\omega}) \right |^2}  \Phi_u(e^{j\omega}) \\
 && + \frac{\left | C(e^{j\omega},\theta) \right  |^2}{\left | G_0(e^{j\omega}) \right |^2 \left | C_d(e^{j\omega})
 \right |^2}\left | L(e^{j\omega}) \right |^2\Phi _d \; d\omega
\label{eq:vrft_framework_noise_vr}
\end{eqnarray}
onde $\Phi_d$ é a densidade do espectro do ruído.

Quando compara-se a equação \eqref{eq:vrft_framework_noise_vr} com a função custo do método sem a presença de ruído
$J_{VR}(\theta)$ (equação \eqref{eq:dbcd_vrft_jvr_cost}) observa-se que há a adição de um termo dentro da integral, 

\begin{equation}
\frac{\left | C(e^{j\omega},\theta) \right  |^2}{\left | G_0(e^{j\omega}) \right |^2 \left | C_d(e^{j\omega})
\right |^2}\left | L(e^{j\omega}) \right |^2\Phi _d
\nonumber
\end{equation}
e que este termo não decai a zero mesmo que $C_d(q) \in \mathcal{C}$. Desta forma é esperado que haja erro de
polarização nas estimativas devido ao ruído mesmo quando a classe de controladores consegue descrever o controlador
ideal.

Para que haja rejeição a este rudo no método, em \cite{campi_leccini_savaresi2002} foi sugerido a
adição da variável instrumental $\zeta(t)$. Em \eqref{eq:vrft_framework_noise_iv} apresenta-se o
regressor deste instrumento:

\begin{equation}
\tilde{\varphi }_L(t)=\beta(q)L(q)\left ( T_d(q)^{-1}-1 \right )\tilde{y}(t)
\label{eq:vrft_framework_noise_iv}
\end{equation}

Os parâmetros do controlador podem então ser calculados como em:

\begin{equation}
\theta_{N}^{IV}=\left [ \sum_{t=1}^{N}\zeta(t) \tilde{\varphi}_L(t)^T \right ]^{-1}\left [ 
\sum_{t=1}^{N}\zeta(t)u_L(t) \right ]
\label{eq:vrft_framework_noise_theta_iv}
\end{equation}

São propostas duas alternativas para a escolha da variável instrumental. A primeira garante
assintoticamente que $\theta_N^{IV}= \theta_0$, entretanto um experimento adicional é
requisitado. O segundo não garante, rigorosamente, $\theta_N^{IV}= \theta_0$ mas o erro
esperado é pequeno, além disso um segundo experimento não é necessário. \cite{campi_leccini_savaresi2002}

\begin{itemize}
	\item {\it{Experimento Repetido:}} Executa-se um segundo experimento com a mesma entrada $u(t)$,
	adquirindo-se a saída $\tilde{y}(t)'$. Como o ruído entre um experimento e outro é independente,
	$\tilde{y}(t)$ e $\tilde{y}(t)'$ serão diferentes. Obtém-se então a variável instrumental:
	
	\begin{equation}
	\zeta(y)=\beta(q)L(q)\left ( T_d(q)^{-1}-1 \right )\tilde{y}(t)'
	\nonumber
	\end{equation}
	
	\item {\it{Identificação da planta:}} Identifica-se a planta $G_0(q)$ com uma família de modelos como $G(q,\theta_G)$ a
	partir do conjunto de dados $\left \{ u(t), \; \tilde{y}(t) \right \}_{t=1,..., N}$ e então gera-se o sinal simulado
	$\hat{y}=G(q,\theta_G)u(t)$, obtendo a variável instrumental como:

	\begin{equation}
	\zeta(y)=\beta(q)L(q)\left ( T_d(q)^{-1}-1 \right )\hat{y}(t)
	\nonumber
	\end{equation}
	
	Devido às incertezas na estimativa de $G(q,\theta_G)$, este segundo método não garante que a
	estimativa tenda assintoticamente a $\theta_0$.
\end{itemize}

%===============================================================================
\subsection{Exemplos ilustrativos}
\label{sec:dbcd_vrft_examples}
%===============================================================================

Nesta seção serão apresentados alguns exemplos ilustrativos da utilização do método do VFRT. Serão utilizados sistemas
lineares modelados pelas classes de modelos ARX e BJ quando o controlador ideal $C_d(q)$ faz parte da classe de
controladores $C(q,\theta)$ e também um caso onde o controlador ideal não consegue ser presentado pela classe de
controlador escolhida.

Nas identificações apresentadas a seguir será sempre utilizado um sinal PRBS de ordem 7.

%===============================================================================
\subsubsection{Controlador PI - sistema Box-Jenkins}
\label{sec:dbcd_vrft_examples_pi_bj}
%===============================================================================

Considere o sistema real definido como:

\begin{equation}
G_{ 0 }(q)=\frac { 0.5 }{ q-0.85 } ,\quad \quad \quad H_{ 0 }(q)=\frac { q }{
q-0.4 } 
\nonumber
\end{equation}

Este sistema pode ser compreendido como um sistema {\it{Box-Jenkins}} (BJ)
(Tabela \ref{table:si_modeling_models}). Deseja-se que o sistema em malha
fechada comporte-se de acordo com:

\begin{equation}
T_d(q)=\frac { 0.4 }{ q-0.6 }
\label{eq:vrft_methos_ex_bj_M}
\end{equation}

Tem-se assim que o controlador ideal é dado por:

\begin{equation}
C_d(q)=\frac{T_d(q)}{G_0(q)(1-T_d(q))} = \frac { 0.8(q - 0.85) }{ q-1 }
\label{eq:vrft_methos_ex_bj_cd}
\end{equation}

Observa-se que este controlador pode ser representado como um controlador {\it{PI}} como em: 

\begin{equation}
C(q, \theta)=\frac { \theta_1 q +\theta_2}{ q-1 }
\label{eq:vrft_methos_ex_bj_c}
\end{equation}

Escolheu-se \eqref{eq:vrft_methos_ex_bj_c} como sendo a classe de modelos a ser utilizada para a identificação do
controlador.

Utilizando o método do VRFT para identificação do controlador quando este está submetido a um ruído $\sigma_e^2=0.005$
obtém-se as estimativas dos parâmetros $\theta_1$ e $\theta_2$ apresentados na Figura \ref{fig:vrft_bj_M10_var005}
com um resultado de 100 simulações com $N=2540$ cada.

\begin{figure}[htbp]
	\center
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var005.eps}
	\caption{Resultado das 100 estimativas de Monte Carlo dos parâmetros $\theta_1$ e $\theta_2$ para o controlador
	apresentado em \eqref{eq:vrft_methos_ex_bj_c}. Com $\sigma_e^2=0.005$}
	\label{fig:vrft_bj_M10_var005}
\end{figure}

Os parâmetros reais esperados para o controlador (equação \eqref{eq:vrft_methos_ex_bj_cd}) e a média de todas
as estimativas $\hat{\theta}_N$ (valor representado por uma estrela na Figura \ref{fig:vrft_bj_M10_var005}) não são os
mesmos. Em uma situação onde o erro de polarização das estimativas não existe, o aumento de N (número de
amostras) implica que esta diferença diminui, tendendo a zero. Em um cenário onde há erro de polarização, se 
aumentarmos a variância do ruído do sistema, será observado um aumento desta diferença.

Na Figura \ref{fig:vrft_bj_M10_var02} é apresentado o resultado para a estimativa de $\theta$ quando a variância do 
ruído é quadruplicada ($\sigma_e^2=0.02$). Observa-se então que o erro de polarização existe na estimativa. Como
descrito em \cite{campi_leccini_savaresi2002} quando o método do VRFT é utilizado com ruído nas amostras, a estimativa
é inevitavelmente polarizada. Na Seção \ref{sec:dbcd_vrft_framework_noise} foi sugerido o uso de variáveis
instrumentais para que este erro de polarização seja minimizado. Utilizou-se então este método e para um ruído com
a mesma variância ($\sigma_e ^2=0.02$), o resultado obtido é o apresentado na Figura \ref{fig:vrft_bj_M10_var02_iv}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var02.eps}
	\caption{100 estimativas Monte Carlo dos parâmetros $\theta_1$ e $\theta_2$ para o controlador apresentado em
	\eqref{eq:vrft_methos_ex_bj_c} com um ruído de variância de $\sigma_e^2=0.02$.}
	\label{fig:vrft_bj_M10_var02}
\end{figure}

\begin{figure}[htbp]
	\center
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var02_iv.eps}
	\caption{Resultado das 100 estimativas de Monte Carlo dos parâmetros $\theta_1$ e $\theta_2$ para o
	controlador apresentado em \eqref{eq:vrft_methos_ex_bj_c} com variância do
	ruído $\sigma_e^2=0.02$ utilizando variáveis instrumentais para estimar os parâmetros.}
	\label{fig:vrft_bj_M10_var02_iv}
\end{figure}

Observa-se que o erro de polarização foi minimizado e que o resultado obtido possui um custo $J_{VR}^N(\theta)
= 5.1242$ e a variância dos parâmetros estimados foi de $0.5064\times10^{-6}$ para $\theta_1$ e de
$0.5495\times10^{-6}$ para $\theta_2$.

A fim de comparar o método VRFT utilizando e não utilizando variáveis instrumentais são apresentados abaixo as
Tabelas \ref{table:vrft_method_bj} e \ref{table:vrft_method_bj_iv} onde os custo $J_{y}$ e $J_{VR}^N$ são
apresentados para diferentes valores de variância do ruído para o mesmo sistema BJ.

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{y}$ além da variância das estimativas para diferentes valores de $\sigma_e^2$
quando o método VRFT não utiliza variáveis instrumentais para a estimativa dos parâmetros $\theta$}
\label{table:vrft_method_bj}
\begin{tabular}{ccccc}
\hline
        Variância $\sigma_e^2$ & $J_{VR}^N(\theta)$ & $J_y(\theta)$ & Média $\theta_1$ & Média $\theta_2$  \\
\hline
	 0.1 	 & 	 $4.87826\times10^{-2}$ 	 & 	 $2.15324\times10^{-2}$ 	 & 	 0.76178 	 & 	 0.64466 \\ 
	 0.08 	 & 	 $3.26789\times10^{-2}$ 	 & 	 $1.35688\times10^{-2}$ 	 & 	 0.7759 	 & 	 0.65765 \\ 
	 0.06 	 & 	 $1.80426\times10^{-2}$ 	 & 	 $7.86422\times10^{-3}$ 	 & 	 0.78597 	 & 	 0.66715 \\ 
	 0.05 	 & 	 $1.19341\times10^{-2}$ 	 & 	 $5.52796\times10^{-3}$ 	 & 	 0.79017 	 & 	 0.67088 \\ 
	 0.04 	 & 	 $7.54289\times10^{-3}$ 	 & 	 $3.65088\times10^{-3}$ 	 & 	 0.79351 	 & 	 0.67396 \\ 
	 0.01 	 & 	 $4.89481\times10^{-4}$ 	 & 	 $2.11052\times10^{-4}$ 	 & 	 0.79962 	 & 	 0.67965 \\ 
	 0.008 	 & 	 $3.25810\times10^{-4}$ 	 & 	 $1.83444\times10^{-4}$ 	 & 	 0.79968 	 & 	 0.67969 \\ 
	 0.005 	 & 	 $1.20816\times10^{-4}$ 	 & 	 $5.42193\times10^{-5}$ 	 & 	 0.7999 	 & 	 0.67991 \\ 
	 0.003 	 & 	 $4.73517\times10^{-5}$ 	 & 	 $2.28052\times10^{-5}$ 	 & 	 0.79996 	 & 	 0.67996 \\ 
	 0.001 	 & 	 $5.02347\times10^{-6}$ 	 & 	 $2.77267\times10^{-6}$ 	 & 	 0.8 	     & 	 0.68 \\ 
\hline
\end{tabular}
\end{center}
\end{table*} 
   

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{y}$ além da  variância das estimativas para diferentes valores de
$\sigma_e^2$ quando o método VRFT utiliza variáveis instrumentais para a estimativa dos parâmetros $\theta$}
\label{table:vrft_method_bj_iv}
\begin{tabular}{ccccc}
\hline
        Variância $\sigma_e^2$ & $J_{VR}^N(\theta)$ & $J_{y}(\theta)$  & Média $\theta_1$ & Média $\theta_2$  \\
\hline
	 0.1 	 & 	 $5.19132\times10^{-2}$ 	 & 	 $4.14964\times10^{-4}$ 	 & 	 0.79936 	 & 	 0.67971 \\ 
	 0.08 	 & 	 $3.31577\times10^{-2}$ 	 & 	 $2.96000\times10^{-4}$ 	 & 	 0.80037 	 & 	 0.68007 \\ 
	 0.06 	 & 	 $1.70932\times10^{-2}$ 	 & 	 $2.17256\times10^{-4}$ 	 & 	 0.79989 	 & 	 0.67969 \\ 
	 0.05 	 & 	 $1.27803\times10^{-2}$ 	 & 	 $3.14017\times10^{-5}$ 	 & 	 0.80006 	 & 	 0.68005 \\ 
	 0.04 	 & 	 $7.72145\times10^{-3}$ 	 & 	 $9.43578\times10^{-5}$ 	 & 	 0.79996 	 & 	 0.68006 \\ 
	 0.01 	 & 	 $5.00316\times10^{-4}$ 	 & 	 $3.20694\times10^{-5}$ 	 & 	 0.80005 	 & 	 0.68003 \\ 
	 0.008 	 & 	 $3.44326\times10^{-4}$ 	 & 	 $2.93508\times10^{-5}$ 	 & 	 0.80001 	 & 	 0.68004 \\ 
	 0.005 	 & 	 $1.19855\times10^{-4}$ 	 & 	 $6.96916\times10^{-6}$ 	 & 	 0.79999 	 & 	 0.68 \\ 
	 0.003 	 & 	 $4.22380\times10^{-5}$ 	 & 	 $6.33696\times10^{-6}$ 	 & 	 0.80001 	 & 	 0.68001 \\ 
	 0.001 	 & 	 $5.08709\times10^{-6}$ 	 & 	 $1.18016\times10^{-6}$ 	 & 	 0.8 	 	 & 	 0.68 \\ 
\hline
\end{tabular}
\end{center}
\end{table*}

Utilizando variáveis instrumentais observa-se que o custo $J_{y}(\theta)$ é significativamente mais baixo
quando comparado com o método onde não são utilizadas variáveis instrumentais, corroborando com o que foi apresentado na
Seção \ref{sec:dbcd_vrft_framework_noise}.

%===============================================================================
\subsubsection{Controlador PID - sistema ARX}
\label{sec:dbcd_vrft_examples_pid_arx}
%===============================================================================

Considere o sistema real definido pelo modelo ARX:

\begin{equation}
G_{ 0 }(q)=\frac { q }{ (q-0.9)(q-0.8) } ,\quad \quad \quad H_{ 0 }(q)=\frac { q^2 }{ (q-0.9)(q-0.8) } 
\nonumber
\end{equation}

Deseja-se que o sistema em malha fechada comporte-se como:

\begin{equation}
T_d(q)=\frac { 0.4 }{ q-0.6 }
\label{eq:vrft_methos_ex_arx_M}
\end{equation}

Tem-se assim que o controlador ideal é definido por:

\begin{equation}
C_d(q)=\frac{T_d(q)}{G_0(z)(1-T_d(q))}=\frac { 0.4(q - 0.9)(q-0.8) }{ q(q-1) }
\label{eq:vrft_methos_ex_arx_cd}
\end{equation}

Observa-se que este controlador pode ser representado como um controlador {\it{PID}} como em: 

\begin{equation}
C(q,\theta )=\frac { \theta _{ 1 }q^2+\theta _{ 2 }q+\theta _{ 3 } }{ q(q-1) } 
\label{eq:vrft_methos_ex_arx_c}
\end{equation}

O vetor de parâmetros $\theta_0$ deste sistema é dado por $\theta_0=[ 0.4 \; -0.68 \; 0.288 ]$.

Como já foi observado, a utilização de variáveis instrumentais elimina o erro de polarização
existente nas estimativas do método VRFT quando há presença de ruído. Desta forma as informações apresentadas a seguir serão
feitas utilizando variáveis instrumentais. Na Figura \ref{fig:vrft_arx_M10_var05_iv} é apresentada a estimativa dos
parâmetros do controlador para um ruído de variância $\sigma_e ^2=0.05$. Observa-se que não há erro de polarização nas
estimativas. O custo para esta e outra, estimativas é apresentado na Tabela \ref{table:vrft_method_arx_iv}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_arx_M10_var05_iv.eps}
	\caption{100 estimativas Monte Carlo dos parâmetros $\theta_1$, $\theta_2$ e $\theta_3$ para o controlador
	apresentado em \eqref{eq:vrft_methos_ex_arx_c} com variância do ruído $\sigma_e ^2=0.05$ utilizando
	variáveis instrumentais}
	\label{fig:vrft_arx_M10_var05_iv}
\end{figure}

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{y}$ além da  variância das
estimativas para diferentes valores de $\sigma_e^2$ quando o método
VRFT utiliza variáveis instrumentais para a estimativa dos parâmetros $\theta$ do controlador
\eqref{eq:vrft_methos_ex_arx_c}}
\label{table:vrft_method_arx_iv}
\begin{tabular}{cccrcccl}
\hline
        Variância $\sigma_e^2$ & $J_{VR}^N(\theta)$ & $J_{y}(\theta)$ & & & Média $\theta$ & &  \\
         &  &  & & $\theta_1$ & $\theta_2$ & $\theta_3$ &  \\
\hline
0.1 	 &  $1.02754\times10^{-2}$ 	 & 	$2.21620\times10^{-3}$ 	 &$[$  & 0.39996 & -0.67993  & 0.28796 & $]$ \\ 
0.08 	 &  $6.17981\times10^{-3}$ 	 & 	$2.54891\times10^{-3}$ 	 &$[$  & 0.39998 & -0.67996  & 0.28799 & $]$ \\ 
0.06 	 &  $3.66467\times10^{-3}$ 	 & 	$2.48678\times10^{-3}$ 	 &$[$  & 0.40014 & -0.6803   & 0.28814 & $]$ \\ 
0.05 	 &  $2.66423\times10^{-3}$ 	 & 	$1.13734\times10^{-3}$ 	 &$[$  & 0.40003 & -0.68002  & 0.28802 & $]$ \\ 
0.04 	 &  $1.76864\times10^{-3}$ 	 & 	$1.22744\times10^{-3}$ 	 &$[$  & 0.39991 & -0.6798   & 0.2879  & $]$ \\ 
0.01 	 &  $1.06472\times10^{-4}$ 	 & 	$3.01036\times10^{-4}$ 	 &$[$  & 0.40001 & -0.68     & 0.288   & $]$ \\ 
0.008 	 &  $6.19905\times10^{-5}$ 	 & 	$1.74299\times10^{-4}$ 	 &$[$  & 0.40001 & -0.68002  & 0.28801 & $]$ \\ 
0.005 	 &  $2.47368\times10^{-5}$ 	 & 	$1.02340\times10^{-4}$ 	 &$[$  & 0.4     & -0.68001  & 0.28801 & $]$ \\ 
0.003 	 &  $8.58597\times10^{-6}$ 	 & 	$7.13811\times10^{-5}$ 	 &$[$  & 0.4     & -0.68     & 0.288   & $]$ \\ 
0.001 	 &  $1.07610\times10^{-6}$ 	 & 	$2.72957\times10^{-5}$ 	 &$[$  & 0.4     & -0.68     & 0.288   & $]$ \\ 
\hline
\end{tabular}
\end{center}
\end{table*}

Na Tabela \ref{table:vrft_method_arx_iv} observa-se que o custo $J_{y}(\theta)$ aumenta com a quantidade de ruído
inserido sobre o sistema, mas observa-se que não há erro de polarização nas estimativas. O valor médio das estimativas
está em todas as simulações muito próximo ao valor real $\theta_0$ almejado.

%===============================================================================
\subsubsection{Controlador não pertence a classe}
\label{sec:dbcd_vrft_examples_not_in_class}
%===============================================================================

Até este ponto foram apresentados exemplos de uso do método VRFT quando o controlador que leva o sistema para
o comportamento desejado $T_d(q)$ faz parte da classe escolhida para a identificação. Nesta seção será apresentado um
exemplo onde a classe de modelos do controlador escolhida não consegue representar o controlador ideal $C_d(q)$. 
Considere para isso o sistema real descrito por:

\begin{equation}
G_{ 0 }(q)=\frac { 0.2(q-0.7) }{ (q-0.9)(q-0.5) } ,\quad \quad \quad H_{ 0 }(q)=\frac { q }{ q-0.3 } 
\nonumber
\end{equation}

Deseja-se que em malha fechada ele se comporte como em: 

\begin{equation}
T_d(q)=\frac { 0.16q }{ (q-0.6)^2 }
\label{eq:vrft_methos_ex_pid_not_M}
\end{equation}

Neste caso o controlador ideal é definido por

\begin{equation}
C_{ d }(q)=\frac { 0.8q(q-0.9)(q-0.5) }{ (q-1)(q-0.36)(q-0.7) } 
\label{eq:vrft_methos_ex_pid_not_cd}
\end{equation}

Para esta identificação optou-se por um controlador do tipo PID como em:
 
\begin{equation}
C(q,\theta )=\frac { \theta _{ 1 }q^2+\theta _{ 2 }q+\theta _{ 3 } }{ q(q-1) } 
\label{eq:vrft_methos_ex_pid_not_c}
\end{equation}

Utilizando o procedimento descrito na Seção \ref{sec:dbcd_vrft_framework_noise} e o procedimento de experimento
repetido, foram feitos 100 experimentos de Monte Carlo e o resultado obtido para a média das estimativas foi:

\begin{equation}
\theta_L =\left[ 0.8101 \quad -0.1691  \quad -0.3358 \right]^T
\nonumber
\end{equation}
onde o índice $L$ indica que este resultado foi obtido utilizando-se o filtro $L$.

Repetindo a simulação, mas agora sem que o procedimento da utilização do filtro $L$ descrito na Seção
\ref{sec:dbcd_vrft_framework_noise}, obteve-se o resultado seguinte:

\begin{equation}
\theta =\left[ 0.5846 \quad -0.2108  \quad -0.1525 \right]^T
\nonumber
\end{equation}

Aplicando-se estes resultados ao controlador apresentado em \eqref{eq:vrft_methos_ex_pid_not_c} e de posse do
comportamento desejado para o sistema em malha fechada ($T_d(q)$) é possível fazer um comparativo da resposta
ao salto unitário para o sistema utilizando os dois controladores obtidos. O resultado é apresentado na Figura
\ref{fig:vrft_notinclass_step}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_notinclass_step.eps}
	\caption{Comparativo da resposta do sistema a um degrau unitário quando o controlador inserido é obtido pelo
	método VRFT utilizando o filtro L e quando não se utiliza este artifício.}
	\label{fig:vrft_notinclass_step}
\end{figure}

Observa-se que para o sistema que utiliza o controlador estimado utilizando-se o filtro $L$, a resposta ao
degrau unitário tem menos erro que o sistema utilizando o outro controlador, ficando este primeiro muito mais próximo da
função $T_d(q)$ desejada. Os custos destes dois sistemas são apresentados na Tabela \ref{table:vrft_method_notinclass}.

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{y}$ para o sistema controlado por $C(q)$ e $C_L(q)$}
\label{table:vrft_method_notinclass}
\begin{tabular}{ccc}
\hline
        Controlador & $J_{VR}^N(\theta)$ & $J_{y}(\theta)$ \\
\hline
	$C(q)$   & 0.2877 &  0.1270 \\
	$C_L(q)$ & 0.4481 &  0.0542 \\
\hline
\end{tabular}
\end{center}
\end{table*}

A fim de comparar as duas estimativas, na Figura \ref{fig:vrft_notinclass_bode} é apresentado o diagrama de
Bode dos controladores obtidos (utilizando a média das estimativas obtidas).

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_notinclass_bode.eps}
	\caption{Diagrama de Bode para as funções de transferência dos controladores estimados utilizando VRFT com e
	sem o filtro $L(q)$ e variáveis instrumentais.}
	\label{fig:vrft_notinclass_bode}
\end{figure}

