% ===============================================================================
\section{VRFT}
\label{sec:vrft_vrft}
% ===============================================================================

VRFT do inglês {\it{Virtual reference feedback tuning}} é um método direto para identificação de
controladores, ou seja, não é necessário o conhecimento ou identificação da planta para que este método seja
utilizado. Desta forma pode ser utilizado com apenas um conjunto de dados, não necessitando de experimentos
específicos. O procedimento procura pelo ponto ótimo do critério escolhido para a identificação do
controlador. \cite{campi_savaresi2000}

Diferentemente de métodos iterativos, o VRFT não recai sobre minimos locais, sempre procurando o mínimo
global do critério escolhido. Isso só não é  verdade sempre pois esta aformativa depende das limitações de
qualidade e exitabilidade do sinal utilizado para se adquirir os dados utilizados no processo. Dentro destas
limitações é possivel afirmar que o método VRFT irá procurar pelo menor mínimo possível. Se o sinal utilizado
para exitar o sistema for suficientemente informativo, então o minimo encontrado pelo método será um minimo
global.

Assume-se que a planta do sistema é {\it{linear}} SISO ({\it{single input single output}}) de tempo discreto
descrito pela função de transferência racional $G(z)$. Tal que esta função de transferência é desconhecida e
tem-se apenas acesso ao conjunto de dados coletados do experimento.
\cite{campi_leccini_savaresi2002}

O controlador a ser identificado pode ser parametrizado como em \eqref{eq:vrft_method_controller}

\begin{equation}
C(z,\theta)=\beta^T(z)\theta
\label{eq:vrft_method_controller}
\end{equation}

Onde $\beta(z) = \left [ \beta_1(z)\;\; \beta_2(z)\;\; \cdots \;\; \beta_n(z)\right ]^T$ é um vetor
linear de funções de transferências de tempo discreto e $\theta = \left [ \vartheta_1 \;\;
\vartheta_2 \;\; \cdots \;\; \vartheta_n \right ]^T \in \mathcal{R}^n$ é um vetor $n$-dimensional de
parâmetros a serem estimados.

O problema de identificação do controlador consiste em encontrar um $\hat{\theta}$ que minimize o
critério performance \eqref{eq:vrft_method_cost_func} que é dependente do modelo de referência
escolhido.

\begin{equation}
J_{MR}(\theta) = \left \| \left ( \frac{G(z)C(z,\theta)}{1+G(z)C(z,\theta)} -M(z) \right )W(z)
\right \|_2^2 
\label{eq:vrft_method_cost_func}
\end{equation} 

Sendo $M(z)$ o modelo de referência a ser atingido em malha fechada quando o controlador
obtido é aplicado sobre a planta e $W(z)$ é uma matriz para ponderação escolhida pelo usuário.

Como já mencionado, VRFT é um método {\it{direto}}, onde os dados coletados da planta são utilizados
diretamente para identificar o controlador e não há necessidaade de identificação da planta para
então haver a identificação do controlador. Métodos diretos são conceitualmente mais naturais que
os indiretos, mas mesmo com o apelo que estes métodos possuem, apenas alguns métodos genuinamente
diretos são encontrados na literatura, dois destes são VRFT e IFT (seção
(\ref{sec:vrft_control_ift})), mesmo estes dois métodos pertencendo uma a mesma classe de métodos,
algumas diferenças são ressaltadas: \cite{campi_savaresi2000}

\begin{itemize}
	\item {\it{IFT}} é baseado em um métodos de gradiente decrescente e além disso é uma técnica
	iterativa. Usualmente este método converge para o minimo local mais próximo das condições iniciais.
	Ele requer experimentos específicos sobre a planta, com entradas especificas.
	\item {\it{VRFT}} é um procedimento não iterativo que procura pelo minimo global do critério de
	performance \eqref{eq:vrft_method_cost_func}. Este método não requer experimentos específicos sobre
	a planta, podendo inclusive utilizar os dados do funcionamento normal da planta.
\end{itemize}

%===============================================================================
\subsection{O método}
\label{sec:vrft_framework}
%===============================================================================

Nesta seção será apresentado uma breve descrição de como o algoritmo para obtenção do controlador
utilizando o método VRFT é formulado. Para maiores detalhes e discussões aprofundadas é
indicada a leitura de \cite{campi_savaresi2000}, 
\cite{campi_leccini_savaresi2002} e \cite{campestrini_nonminumum_phase}.

Suponha que o controlador $C(z, \theta)$ resulta um sistema em malha fechada cuja função de
transferência é dada por $M(z)$. Desta forma, se $M(z)$ for alimentado com qualquer sinal $r(t)$,
sua saída será $M(z)r(t)$. Uma premissa para que o sistema em malha fechada tenha a mesma
função de transferência que o modelo de referência é que a saída dos dois seja a mesma para um dado
sinal $\bar{r}(t)$.

Baseado no sinal medido $y(t)$, considera-se um sinal $\bar{r}(t)$ tal que $M(z)\bar{r}(t)=y(t)$.
Esta referência é conhecida como {\it{virtual}} pois ela não existe e não foi utilizada para gerar o
sinal $y(t)$. A figura (\ref{fig:vrft_method_cl}) apresenta o sistema em malha fechada e os sinais
utilizados.

\begin{figure}[htbp]
\center
%\scalebox{1} % Change this value to rescale the drawing.
%{
\begin{pspicture}(0,-1.4292188)(9.02,1.4692187)
\pscircle[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](1.4,0.97078127){0.2}
\psframe[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](4.8,1.3707813)(3.0,0.57078123)
\psframe[linewidth=0.04,dimen=outer](7.6,1.3707813)(6.0,0.57078123)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(0.0,0.97078127)(1.2,0.97078127)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(1.6,0.97078127)(3.0,0.97078127)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(4.8,0.97078127)(6.0,0.97078127)
\psline[linewidth=0.04cm](7.6,0.97078127)(9.0,0.97078127)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{<-}(1.4,0.7707813)(1.4,-0.02921875)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm](1.4,-0.02921875)(8.4,-0.02921875)
\psline[linewidth=0.04cm,linestyle=dashed,dash=0.16cm 0.16cm](8.4,-0.02921875)(8.4,0.97078127)
\usefont{T1}{ptm}{m}{n}
\rput(1.1126562,1.2807813){+}
\usefont{T1}{ptm}{m}{n}
\rput(1.6473438,0.68078125){-}
\usefont{T1}{ptm}{m}{n}
\rput(0.47,1.2707813){\small $\bar{r}(t)$}
\usefont{T1}{ptm}{m}{n}
\rput(3.99,0.97078127){\small $C(z, \rho)$}
\usefont{T1}{ptm}{m}{n}
\rput(6.76,0.9507812){\small $G_0(z)$}
\usefont{T1}{ptm}{m}{n}
\rput(5.51,1.2707813){\small $u(t)$}
\usefont{T1}{ptm}{m}{n}
\rput(2.25,1.2707813){\small $e(t)$}
\usefont{T1}{ptm}{m}{n}
\rput(8.3,1.2707813){\small $y(t)$}
\psframe[linewidth=0.04,dimen=outer](6.0,-0.62921876)(3.8,-1.4292188)
\usefont{T1}{ptm}{m}{n}
\rput(4.91,-1.0492188){\small $M^{-1}(z)$}
\psline[linewidth=0.04cm](9.0,0.97078127)(9.0,-1.0292188)
\psline[linewidth=0.04cm](9.0,-1.0292188)(6.0,-1.0292188)
\psline[linewidth=0.04cm](3.8,-1.0292188)(0.0,-1.0292188)
\psline[linewidth=0.04cm](0.0,-1.0292188)(0.0,0.97078127)
\end{pspicture} 
%}
\caption{dlkjhsfjdhf kljh dfh sdlf}
\label{fig:vrft_method_cl}
\end{figure}

O sinal $e(t)$ é o erro entre os sinais $y(t)$ e $\bar{r}(t)$. Sabe-se que quando a planta é
alimentada com o sinal $u(t)$, o sinal $y(t)$ é obtido. Em um controlador, quando este é
alimentado com o sinal $e(t)$, o sinal $u(t)$ é obtido. A tarefa do método VRFT é encontrar este
controlador, como os sinais $u(t)$ e $e(t)$ são conhecidos, a tarefa reduz-se a um problema de
identificação. Comumente, usa-se um pré-filtro nos dados coletados. A ideia principal do uso deste
filtro será explicada posteriormente na seção (\ref{sec:vrft_framework_filter}). 

O algoritmo pode ser descrito pelos passos a seguir \cite{campi_savaresi2000}:

\begin{enumerate}
	\item Filtram-se os sinais de entrada e saída com algum filtro $L(z)$:

\begin{equation}
y_L (t)=L(z)y(t), \;\;\; u_L (t)=L(z)u(t) 
\label{eq:vrft_method_algorithm_filter_io}
\end{equation}

\item Encontra-se um sinal de referência $\bar{r}_L (t)$ no qual a saída do modelo de referência
$M(z)$ seja exatamente $y_L (t)$ quando alimentado pelo sinal:

\begin{equation}
y_L (t)=M(z) \bar{r}_L (t)
\label{eq:vrft_method_algorithm_ref}
\end{equation}

\item Selecione o vetor de parametros do controlador $\hat{\theta}$ que minimize o critério
\eqref{eq:vrft_method_algorithm_criter}

\begin{equation}
J_{VR}^N(\theta)=\frac{1}{N}\sum_{t=1}^{N}(u_L(t)-\varphi_L^T(t)\theta)^2
\label{eq:vrft_method_algorithm_criter}
\end{equation}

\begin{equation}
\varphi_L(t)=\beta(z)e_L(t)
\nonumber
\end{equation}

Desde que \eqref{eq:vrft_method_algorithm_criter} seja quadrática em $\theta$ o vetor de parametros
$\hat{\theta}$ que minimizam esta função custo podem ser calculados com
\eqref{eq:vrft_method_algorithm_result}.


\begin{equation}
\hat{\theta}= \left [ \sum_{t=1}^{N}\varphi_L(t) \varphi_L(t)^T\right ]^{-1}
\sum_{t=1}^{N}\varphi_L(t) u_L(t)
\label{eq:vrft_method_algorithm_result}
\end{equation}

\end{enumerate}

%===============================================================================
\subsubsection{Filtro $L(z)$}
\label{sec:vrft_framework_filter}
%===============================================================================

Considerando a função custo $J_{MR}(\theta)$ apresentada em \eqref{eq:vrft_method_cost_func} e o
critério do método de referência virtual $J_{VR}(\theta)$ apresentado em
\eqref{eq:vrft_method_algorithm_criter} serem diferentes. A escolha correta do filtro $L(z)$
propicia que estas duas equações tenham mínimos muito proximos.
\cite{campi_leccini_savaresi2002}

A utilização do filtro é de grande importância em situações onde a escolha do modelo $\mathcal{C}(z,
\theta)$ não consegue representar a totalidade do controlador ótimo ($C_0(z)$) que quando aplicado em conjunto com a
planta proporciona a exata resposta desejada pela escolha de $M(z)$.

\begin{equation}
C_0(z) \notin \mathcal{C}(z, \theta)
\nonumber
\end{equation}

O critério $J_{MR}(\theta)$ pode ser reescrito utilizando-se o controlador ótimo $C_0(z)$ como em 
\eqref{eq:vrft_method_filter_cost_func}

\begin{equation}
J_{MR}(\theta)= \frac{1}{2\pi} \int_{-\pi}^{\pi} \frac{\left | G \right |^2 \left | W \right |^2 }
{\left | 1+GC(\theta) \right |^2} 
\frac{\left |C(\theta)-C_0  \right |^2}{\left |1+GC_0 \right |^2}d\omega 
\label{eq:vrft_method_filter_cost_func}
\end{equation}

Considerando que $J_{VR}^N$ seja conhecido, quando a quantidade de dados cresce: $N \to \infty$
tem-se \eqref{eq:vrft_method_filter_criter_assim}. 

\begin{equation}
J_{VR}^N(\theta) \to J_{VR}(\theta = E \left [ (u_L(t) - C(z, \theta)e_L(t))^2\right ])
\label{eq:vrft_method_filter_criter_assim}
\end{equation}

Utilizando as definições de $u_L(t)$, $e_L(t)$ e dada a definição de $C_0(z)$ juntament com o
teorema de Perseval \cite{ljung}, o critério assintótico \eqref{eq:vrft_method_filter_criter_assim}
tem sua representação como em \eqref{eq:vrft_method_filter_criter_vr}

\begin{equation}
J_{VR}(\theta)= \frac{1}{2\pi} \int_{-\pi}^{\pi} \left | G \right |^2 \left | C(\theta)-C_0 \right
|^2 \left | 1-M \right |^2 \frac{\left | L \right |^2}{\left | M \right |^2} \Phi_u \; d\omega
\label{eq:vrft_method_filter_criter_vr}
\end{equation}

Onde $\Phi_u $ é a densidade do espectro do sinal $u(t)$.

Para o caso onde $C_0 \in C(z, \theta)$ a escolha de $L(z)$ não afeta o resultado, usualmente
escolhe-se então $L(z)=1$. Caso o controlador não consiga ser representado pelo modelo, a escolha de
$L(z)$ pode ser feita por:

\begin{equation}
\left | L \right | ^2 = \left | 1-M \right | ^2 \left | M \right | ^2 \left | W \right | ^2 \frac{1}
{\Phi_u}, \;\;\; \forall \omega \in [-\pi; \pi].
\label{eq:vrft_method_filter_l}
\end{equation}

Obtem-se com a utilização do filtro, uma estimativa onde o erro de polarização é minimizado.
%===============================================================================
\subsubsection{VRFT e dados corrompidos por ruido}
\label{sec:vrft_framework_noise}
%===============================================================================

Todos os equacionamentos até aqui apresentadso, consideraram que o sistema não seja afetado por
ruido. Nesta seção será apresentado brevemente o comportamento do método quando o sinal $y(t)$ é
corrompido por um ruido aditivo como:

\begin{equation}
\tilde{y}(t)=G(z)u(t) + \xi(t)
\label{eq:vrft_framework_noise_y}
\end{equation}

Assume-se que o sinal $u(t)$ e $\xi(t)$ sejam descorrelacionados e também que os dados são coletados
com a planta trabalhando em laço aberto. \cite{campi_leccini_savaresi2002}. Para a idéia extendida
de dados coletados com a planta em laço fechado, uma explicação mais detalhada pode ser encontrada
em \cite{lecchini}.

Ao aplicar o algoritmo descrito na seção (\ref{sec:vrft_framework}) com dados sugeitos a ruidos, o
resultado obtido possui erro de polarização (seção (\ref{sec:si_par_estim_uncertanties})). Isso pode
ser compreendido analizando a expressão do critério $J_{VR}(\theta)$ quando utiliza-se o sinal
$\tilde{y}(t)$:


\begin{equation}
J_{VR}(\theta)= \frac{1}{2\pi} \int_{-\pi}^{\pi} \left [ \left | G \right |^2 \left | C(\theta)-C_0
\right |^2 \left | 1-M \right |^2 \frac{\left | L \right |^2}{\left | M \right |^2} \Phi_u +\frac{\left | 
C(\theta) \right |^2}{\left | G \right |^2 \left | C_0 \right |^2}\left | L \right |^2\Phi _d
\right ] \; d\omega
\label{eq:vrft_framework_noise_vr}
\end{equation}

Onde $\Phi_d$ é a densidade do espectro do ruido.

Para que haja rejeição a este rudo no método, em \cite{campi_leccini_savaresi2002} foi sugerido a
adição da variável instrumental $\zeta(t)$. Em \eqref{eq:vrft_framework_noise_iv} apresenta-se o
regressor deste instrumento:

\begin{equation}
\tilde{\varphi }_L=\beta(z)L(z)\left ( M(z)^{-1}-1 \right )\tilde{y}(t)
\label{eq:vrft_framework_noise_iv}
\end{equation}

Os parametros do controlador $\hat{\theta}^{IV}_N $ podem então ser calculados como em
\eqref{eq:vrft_framework_noise_theta_iv}.

\begin{equation}
\hat{\theta}_{N}^{IV}=\left [ \sum_{t=1}^{N}\zeta(t) \tilde{\varphi}_L(t)^T \right ]^{-1}\left [ 
\sum_{t=1}^{N}\zeta(t)u_L(t) \right ]
\label{eq:vrft_framework_noise_theta_iv}
\end{equation}

São propostas duas alternativas para a escolha da variável instrumental. A primeira garante
assimtoticamente que $\hat{\theta}^{IV}= \hat{\theta}$, entretanto um experimento adicional é
requisitado, o segundo não garante rigorosamente $\hat{\theta}^{IV}= \hat{\theta}$, mas o erro
esperado é pequeno, além disso um segundo experimento não é necessário.
\cite{campi_leccini_savaresi2002}

\begin{itemize}
	\item {\it{Experimento Repetido:}} Executa-se um segundo experimento com a mesma entrada $u(t)$,
	adquirindo-se a saida $\tilde{y}(t)'$. Como o rudio entre um experimento e outro é independente,
	$\tilde{y}(t)$ e $\tilde{y}(t)'$ serão diferentes. Obtem-se então a variavel instrumental:
	
	\begin{equation}
	\zeta(y)=\beta(z)L(z)\left ( M(z)^{-1}-1 \right )\tilde{y}(t)'
	\nonumber
	\end{equation}
	
	\item {\it{Identificação da planta:}} Identifica-se um modelo para a planta $\hat{G}(z)$ a partir
	do conjunto de dados $\left \{ u(t), \; \tilde{y}(t) \right \}_{t=1,..., N}$  e então gera-se o
	sinal simulado $\hat{y}=\hat{G}u(t)$, obtendo a variavel instrumental como:

	\begin{equation}
	\zeta(y)=\beta(z)L(z)\left ( M(z)^{-1}-1 \right )\hat{y}(t)
	\nonumber
	\end{equation}
	
	Devido as incertezas na estimativa de $\hat{G}(z)$, este segundo método não garante que a
	estimativa tenda assimtoticamente a $\hat{\theta}$.
	
\end{itemize}

%===============================================================================
\subsection{Exemplos ilustrativos}
\label{sec:vrft_examples}
%===============================================================================

Nesta seção serão apresentados alguns exemplos ilustrativos da utilização do método do VFRT. Para isso serão
utilizados sistemas lineares modelados utilizando modelos ARX e BJ quando o controlador $C(z, \rho)$ faz parte
da classe de controladores que representa completamente o controlador ideal. Sendo este o controlador que
consegue levar o sistema para o comportamento escolhido $M(z)$.

Nas identificações apresentadas a seguir será sempre utilizado um sina PRBS (Seção
(\ref{sec:si_project_signal_input_prbs})) de ordem 7.

%===============================================================================
\subsubsection{Controlador PI - sistema Box-Jenkins}
\label{sec:vrft_examples_pi_bj}
%===============================================================================

Para um sistema onde $G_0(z)$ e $H_0(z)$ podem ser definidos como:

\begin{equation}
G_{ 0 }(z)=\frac { 0.5 }{ z-0.85 } ,\quad \quad \quad H_{ 0 }(z)=\frac { z }{
z-0.4 } 
\nonumber
\end{equation}

Este sistema pode ser compreendido como um sistema {\it{Box-Jenkins}} (BJ)
(Tabela (\ref{table:si_modeling_models})). Deseja-se que o sistema em malha
fechada comporte-se o mais próximo possível do modelo apresentado em
\eqref{eq:vrft_methos_ex_bj_M}.

\begin{equation}
M(z)=\frac { 0.4 }{ z-0.6 }
\label{eq:vrft_methos_ex_bj_M}
\end{equation}

Tem-se assim que o controlador ideal, aquele que ao ser inserido no sistema em
malha fechada apresentado na Figura (\ref{fig:vrft_db_control_loop}) propicia o
comportamento descrito por \eqref{eq:vrft_methos_ex_bj_M} é:

\begin{equation}
C_d(z)=\frac { 0.8(z - 0.85) }{ z-1 }
\label{eq:vrft_methos_ex_bj_cd}
\end{equation}

Observa-se que este controlador pode ser representado como um controlador
{\it{PI}} como em \eqref{eq:vrft_methos_ex_bj_c}. 

\begin{equation}
C(z, \rho)=\frac { \rho_1 z +\rho_2}{ z-1 }
\label{eq:vrft_methos_ex_bj_c}
\end{equation}

Utilizando o método do VRFT para identificação do controlador quando este está submetido a um ruido $\sigma
_\upsilon ^2=0.005$ obtem-se a estimativas dos parametro s $\rho_1$ e $\rho_2$ apresentados na Figura
(\ref{fig:vrft_bj_M10_var005}) com um resultado de 100 simulações de 2540 amostras cada.

\begin{figure}[htbp]
	\center
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var005.eps}
	\caption{100 estimativas Monte Carlo dos parametros $\rho_1$ e $\rho_2$ para o
	controlador apresentado em \eqref{eq:vrft_methos_ex_bj_c}}
	\label{fig:vrft_bj_M10_var005}
\end{figure}

Os parametros reais esperados para o controlador (equação \eqref{eq:vrft_methos_ex_bj_cd}) e a média de todas
as estimativas (valor representado por uma estrela na Figura (\ref{fig:vrft_bj_M10_var005})) não são os
mesmos. Em uma situação onde o erro de polarização das estimativas não existe, o aumento de N (número de
amostras) implica que esta diferença diminui, tendendo a zero. Em um cenário onde há erro de polarização, se 
aumentarmos a variância do ruido do sistema, será observado um aumento desta diferença.

Na figura (\ref{fig:vrft_bj_M10_var02}) quadruplicou-se a variância do ruido inserido no sistema ($\sigma
_\upsilon ^2=0.02$). Observa-se então que o erro de polarização existe na estimativa. Como descrito em
\cite{campi_leccini_savaresi2002} quando o método do VRFT é utilizado com ruido nas amostras, a estimativa é
inevitavelmente polarizada. Neste mesmo trabalho é sugerido a utilização de {\it{variaveis instrumentais}}
(Seção (\ref{sec:si_par_estim_iv})) para que este erro de polarização seja minimizado.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var02.eps}
	\caption{100 estimativas Monte Carlo dos parametros $\rho_1$ e $\rho_2$ para o controlador apresentado em
	\eqref{eq:vrft_methos_ex_bj_c} com varancia do ruido de 0.02}
	\label{fig:vrft_bj_M10_var02}
\end{figure}

Utilizando o procedimento descrito na seção (\ref{sec:vrft_framework_noise}) para dados corrompidos por ruido
o resultado obtido, para a mesma variância de $\sigma_\upsilon ^2=0.02$ do ruido, é apresentado na Figura
(\ref{fig:vrft_bj_M10_var02}).

\begin{figure}[htbp]
	\center
	\includegraphics[width=0.95\columnwidth]{figures/vrft_bj_M10_var02_iv.eps}
	\caption{100 estimativas Monte Carlo dos parametros $\rho_1$ e $\rho_2$ para o
	controlador apresentado em \eqref{eq:vrft_methos_ex_bj_c} com varancia do
	ruido de 0.02. Utilizando variáveis instrumentais para estimar os parametros.}
	\label{fig:vrft_bj_M10_var02_iv}
\end{figure}

Observa-se que o erro de polarização foi minimizado e que o resultado obtido possui um custo $J_{VR}^N(\theta)
= 5.1242$ e a variância dos parametros estimados foi de $0.5064e-06$ para $\rho_1$ e de $0.5495e-06$ para
$\rho_2$.

A fim de comparar o metodo VRFT utilizando e não utilizando variaveis instrumentais são apresentados abaixo as
Tabelas (\ref{table:vrft_method_bj}) e (\ref{table:vrft_method_bj_iv}) onde o custo $J_{MR}$ (equação
\eqref{eq:vrft_method_cost_func}) e o custo $J_{VR}^N$ (equação \eqref{eq:vrft_method_filter_criter_assim})
são apresentados para diferentes valores de variância do ruido para o mesmo sismtema BJ.

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{MR}$ além da  variância das
estimativas para diferentes valores de $\sigma _\upsilon ^2$ quando o metodo
VRFT não utiliza variáveis instrumentais para a estimativa dos parametros
$\rho$}
\label{table:vrft_method_bj}
\begin{tabular}{cccc}
\hline
        Variância $\sigma _\upsilon ^2$ & $J_{VR}^N(\theta)$ &
        $J_{MR}(\theta)$ & Variância estimativas $\rho$   \\
\hline
	    0.06    & 1.7893$\times10^{-2}$ & 8.2367$\times10^{-3}$ & 1.0$\times10^{-5}$\;[0.4754    0.4434] \\
	    0.05    & 1.2515$\times10^{-2}$ & 5.5366$\times10^{-3}$ & 1.0$\times10^{-5}$\;[0.2671    0.3244] \\
        0.04    & 8.1897$\times10^{-3}$ & 3.6071$\times10^{-3}$ & 1.0$\times10^{-5}$\;[0.1534    0.1583] \\
        0.01    & 4.9665$\times10^{-4}$ & 2.4402$\times10^{-4}$ & 1.0$\times10^{-6}$\;[0.0963    0.1035] \\
        0.005   & 1.2515$\times10^{-4}$ & 5.6013$\times10^{-5}$ & 1.0$\times10^{-7}$\;[0.2999    0.3114] \\
        0.001   & 5.0036$\times10^{-6}$ & 3.5734$\times10^{-6}$ & 1.0$\times10^{-8}$\;[0.1301    0.1223] \\
\hline
\end{tabular}
\end{center}
\end{table*} 
   

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{MR}$ além da  variância das
estimativas para diferentes valores de $\sigma _\upsilon ^2$ quando o metodo
VRFT utiliza variáveis instrumentais para a estimativa dos parametros $\rho$}
\label{table:vrft_method_bj_iv}
\begin{tabular}{cccc}
\hline
        Variância $\sigma _\upsilon ^2$ & $J_{VR}^N(\theta)$ &
        $J_{MR}(\theta)$ & Variância estimativas $\rho$   \\
\hline
	    0.06    & 45.1719  &  $9.7345\times10^{-5}$ & $1.0\times10^{-5}\;[0.5161    0.5332]$ \\
	    0.05    & 33.2600  &  $2.0457\times10^{-5}$ & $1.0\times10^{-5}\;[0.2481    0.2652]$ \\
        0.04    & 21.2652  &  $1.1665\times10^{-4}$ & $1.0\times10^{-5}\;[0.2040    0.2084]$ \\
        0.01    & 1.2956   &  $8.9695\times10^{-6}$ & $1.0\times10^{-6}\;[0.1246    0.1138]$ \\
        0.005   & 0.3264   &  $7.4764\times10^{-6}$ & $1.0\times10^{-7}\;[0.3063    0.2917]$ \\
        0.001   & 0.0126   &  $5.2443\times10^{-7}$ & $1.0\times10^{-8}\;[0.1059    0.1017]$ \\
\hline
\end{tabular}
\end{center}
\end{table*}

Utilizando variáveis instrumentais observa-se que o custo $J_{MR}(\theta)$ é significativamente mais baixo
quando comparado com o metodo onde não são utilizadas variáveis instrumentais. Demonstrando assim que o
comportamento desejado do sistema foi atingido com uma melhor aproximação.

%===============================================================================
\subsubsection{Controlador PID - sistema ARX}
\label{sec:vrft_examples_pid_arx}
%===============================================================================

Para um sistema {\it{ARX}} onde $G_0(z)$ e $H_0(z)$ podem ser definidos como:

\begin{equation}
G_{ 0 }(z)=\frac { z }{ (z-0.9)(z-0.8) } ,\quad \quad \quad H_{ 0 }(z)=\frac { z^2 }{ (z-0.9)(z-0.8) } 
\nonumber
\end{equation}

Deseja-se que o sistema em malha fechada comporte-se o mais próximo possível do modelo apresentado em
\eqref{eq:vrft_methos_ex_arx_M}.

\begin{equation}
M(z)=\frac { 0.4 }{ z-0.6 }
\label{eq:vrft_methos_ex_arx_M}
\end{equation}

Tem-se assim que o controlador ideal, aquele que ao ser inserido no sistema em
malha fechada apresentado na Figura (\ref{fig:vrft_db_control_loop}) propicia o
comportamento descrito por \eqref{eq:vrft_methos_ex_arx_M} é:

\begin{equation}
C_d(z)=\frac { 0.4(z - 0.9)(z-0.8) }{ z(z-1) }
\label{eq:vrft_methos_ex_arx_cd}
\end{equation}

Observa-se que este controlador pode ser representado como um controlador
{\it{PID}} como em \eqref{eq:vrft_methos_ex_arx_c}. 

\begin{equation}
C(z,\rho )=\frac { \rho _{ 1 }z^2+\rho _{ 2 }z+\rho _{ 3 } }{ z(z-1) } 
\label{eq:vrft_methos_ex_arx_c}
\end{equation}

Na Figura (\ref{fig:vrft_arx_M10_var005}) é apresentado o resultado da estimativa dos parametros do
controlador quando não são utilizados variaveis instrumentais. Obteve-se desta forma um custo
$J_{VR}^N(\theta) = 2.5008e-05$ e $J_{MR}(\theta) = 1.7746e-05$ além de uma variância para as estimativas de
$1.0e-07 \; [0.0364\;    0.1261\;    0.0377]$ para $\rho_1$, $\rho_2$ e $\rho_3$ respectivamente.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_arx_M10_var005_.eps}
	\caption{100 estimativas Monte Carlo dos parametros $\rho_1$, $\rho_2$ e $\rho_3$ para o controlador
	apresentado em \eqref{eq:vrft_methos_ex_arx_c} com varancia do ruido $\sigma_\upsilon ^2=0.005$}
	\label{fig:vrft_arx_M10_var005}
\end{figure}

Como já foi observado a utilização de variaveis instrumentais melhora significativamente o erro existente nas
estimativas. Desta forma as informações apresentadas a seguir serão feitas utilizando variaveis instrumentais.
Na figura (\ref{fig:vrft_arx_M10_var05_iv}) é apresentado a estimativa dos parametros do controlador para um
ruido com variância $\sigma_\upsilon ^2=0.05$. Observa-se que não há erro de polarização nas estimativas. 
O custo para esta, e outas, estimativas é apresentado na Tabela (\ref{table:vrft_method_arx_iv}).

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_arx_M10_var05_iv.eps}
	\caption{100 estimativas Monte Carlo dos parametros $\rho_1$, $\rho_2$ e $\rho_3$ para o controlador
	apresentado em \eqref{eq:vrft_methos_ex_arx_c} com varancia do ruido $\sigma_\upsilon ^2=0.05$ utilizando
	variáveis instrumentais}
	\label{fig:vrft_arx_M10_var05_iv}
\end{figure}


\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{MR}$ além da  variância das
estimativas para diferentes valores de $\sigma _\upsilon ^2$ quando o metodo
VRFT utiliza variáveis instrumentais para a estimativa dos parametros $\rho$ do controlador
\eqref{eq:vrft_methos_ex_arx_c}}
\label{table:vrft_method_arx_iv}
\begin{tabular}{cccc}
\hline
        Variância $\sigma _\upsilon ^2$ & $J_{VR}^N(\theta)$ &
        $J_{MR}(\theta)$ & Variância estimativas $\rho$   \\
\hline
   0.1     & $10.0743\times10^{-3}$ &  2.2871$\times10^{-3}$ & $1\times10^{-5}\;[0.1253 \; 0.4683 \; 0.1600]$ \\
   0.06    & $ 3.6093\times10^{-3}$ &  1.1279$\times10^{-3}$ & $1\times10^{-5}\;[0.0516 \; 0.1793 \; 0.0575]$ \\
   0.05    & $ 2.5419\times10^{-3}$ &  1.2453$\times10^{-3}$ & $1\times10^{-5}\;[0.0344 \; 0.1237 \; 0.0416]$ \\
   0.04    & $ 1.6013\times10^{-3}$ &  0.5106$\times10^{-3}$ & $1\times10^{-6}\;[0.2195 \; 0.7908 \; 0.2379]$ \\
   0.01    & $10.0077\times10^{-5}$ & 13.7142$\times10^{-5}$ & $1\times10^{-7}\;[0.1552 \; 0.5469 \; 0.1822]$ \\
   0.005   & $ 2.5081\times10^{-5}$ & 10.3482$\times10^{-5}$ & $1\times10^{-7}\;[0.0406 \; 0.1260 \; 0.0375]$ \\
	0.001  & $ 0.1009\times10^{-5}$ &  2.0487$\times10^{-5}$ & $1\times10^{-9}\;[0.1277 \; 0.4035 \;0.1239]$	 \\
\hline
\end{tabular}
\end{center}
\end{table*}

%===============================================================================
\subsubsection{Controlador não pertence a classe}
\label{sec:vrft_examples_not_in_class}
%===============================================================================

Até este ponto foram apresentados exemplos de uso do método VRFT quando o controlador que leva o sistema para
o comportamento desejado $M(z)$ faz parte da classe escolhida para a identificação. Em outras palavras quando
$C(z, \rho) \in \mathcal{C}$. Nesta seção será apresentado um exemplo onde o modelo do controlador escolhido
para o sistema não consegue levar este para $M(z)$.

Considerando o sistema descrito por
\begin{equation}
G_{ 0 }(z)=\frac { 0.2(z-0.7) }{ (z-0.9)(z-0.5) } ,\quad \quad \quad H_{ 0 }(z)=\frac { z }{ z-0.3 } 
\nonumber
\end{equation}

Deseja-se que em malha fechada ele se comporte como em \eqref{eq:vrft_methos_ex_pid_not_M}. 

\begin{equation}
M(z)=\frac { 0.16z }{ (z-0.6)^2 }
\label{eq:vrft_methos_ex_pid_not_M}
\end{equation}

Neste caso o controlador ideal é definido por \eqref{eq:vrft_methos_ex_pid_not_cd}

\begin{equation}
C_{ d }(z)=\frac { 0.8z(z-0.9)(z-0.5) }{ (z-1)(z-0.36)(z-0.7) } 
\label{eq:vrft_methos_ex_pid_not_cd}
\end{equation}

Para esta identificação optou-se por um controlador do tipo PID como em \eqref{eq:vrft_methos_ex_pid_not_c}
 
\begin{equation}
C(z,\rho )=\frac { \rho _{ 1 }z^2+\rho _{ 2 }z+\rho _{ 3 } }{ z(z-1) } 
\label{eq:vrft_methos_ex_pid_not_c}
\end{equation}

Observa-se que \eqref{eq:vrft_methos_ex_pid_not_c} não consegue representar todas as dinâmicas apresentadas em
\eqref{eq:vrft_methos_ex_pid_not_cd}. Utilizando o procedimento descrito na Seção
(\ref{sec:vrft_framework_noise}) e o procedimento de experimento repetido, foram feitos 100 experimentos de
Monte Carlo e o resultado obtido para a média das estimativas foi:

\begin{equation}
\rho_L =\left[ 0.8101 \quad -0.1691  \quad -0.3358 \right]
\nonumber
\end{equation}

Onde o indice $L$ indica que este resultado foi obtido utilizando-se o filtro $L$.

Repetindo a simulação, mas agora sem que o procedimento da utilização do filtro $L$ descrito na seção
(\ref{sec:vrft_framework_noise}), obteve-se o resultado seguinte:

\begin{equation}
\rho =\left[ 0.5846 \quad -0.2108  \quad -0.1525 \right]
\nonumber
\end{equation}

Aplicando-se estes resultados ao controlador apresentado em \eqref{eq:vrft_methos_ex_pid_not_c} e de posse do
comportamento desejado para o sistema em malha fechada ($M(z)$) é possivel fazer um comparativo da resposta de
ao salto para o sistema utilizando os dois controladores obtidos. O resultado é apresentado na Figura
(\ref{fig:vrft_notinclass_step}).

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_notinclass_step.eps}
	\caption{Comparativo da resposta do sistema a um degrau unitário quando o controlador inserido é obtido pelo
	metodo VRFT utilizando o filtro L e quando não se utiliza este artificio. O sistema foi simulado com um
	ruido de variância $\sigma_\upsilon ^2=0.1$}
	\label{fig:vrft_notinclass_step}
\end{figure}

Observa-se que para o sistema que utiliza o controlador estimado utilizando-se o filtro $L$, a resposta ao
degrau unitário tem significativamente menos erro que o sistema utilizando o outro controlador. Ficando este
promeiro muito mais próximo da função $M(z)$ desejada.

Os custos destes dois sistemas é apresentado na Tabela (\ref{vrft_method_notinclass}).

\begin{table*}[htbp]
\begin{center}
\caption{Valor dos custos $J_{VR}^N$ e $J_{MR}$ para o sistema controlado por $C(z)$ e $C_L(z)$}
\label{table:vrft_method_notinclass}
\begin{tabular}{ccc}
\hline
        Controlador & $J_{VR}^N(\theta)$ & $J_{MR}(\theta)$ \\
\hline
	$C(z)$   & 0.2877 &  0.1270 \\
	$C_L(z)$ & 0.4481 &  0.0542 \\
\hline
\end{tabular}
\end{center}
\end{table*}

A fim de comparar as duas estimativas, na figura (\ref{fig:vrft_notinclass_bode}) é apresentado o diagrama de
Bode dos controladores obtidos (utilizando a média das estimativas obtidas).

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_notinclass_bode.eps}
	\caption{Diagrama de Bode para as funções de transferência dos controladores estimados utilizando VRFT com e
	sem o artificio do filtro L e variaveis instrumentais}
	\label{fig:vrft_notinclass_bode}
\end{figure}

