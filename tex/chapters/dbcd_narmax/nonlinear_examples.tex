% ===============================================================================
\section{Exemplos ilustrativos}
\label{sec:dbnarmax_nonlinear_examples}
%===============================================================================

Neste trabalho o foco está em apresentar os resultados da identificação de sistemas que podem ser descritos por modelos
NARMAX racionais ou polinomiais. Sendo que para isso serão apresentados exemplos de identificação de sistemas onde a
linearidade é estática assim como quando a não linearidade está na dinâmica do sistema.

Nos exemplos abordados a seguir as não linearidades estarão presentes na planta do sistema e deseja-se que este sistema
se comporte em malha fechada como um sistema linear. Para isso o controlador adicionado na malha deverá ser capaz de
anular a não linearidade contida na planta, desta forma, forçosamente o controlador será não linear, sendo descrito por
um modelo NARMAX racional ou polinomial.

%===============================================================================
\subsection{Não linearidades estáticas}
\label{sec:dbnarmax_nl_wiener}
%===============================================================================

Considere que a planta do sistema real possui uma não linearidade estática do tipo Wiener, onde o bloco não linear
encontra-se na saída do processo. Na Figura \ref{fig:vrft_nl_wiener} é apresentado o diagrama de blocos do sistema,
sendo $\zeta(t)$ e $\gamma(t)$ os blocos não lineares da planta e do controlador respectivamente. Analogamente
$G'(z)$ e $C'(z)$ são os blocos lineares da planta e do controlador. Como a não linearidade do controlador está na
entrada, este poderia ser caracterizado como uma classe de Hammerstein, mas será identificado por uma classe
de modelos NARMAX racional, não deixando entretanto de ``ser'' um modelo de Hammerstein.

\begin{figure}[htbp]
\center
% Generated with LaTeXDraw 2.0.8
% Sat Jun 16 14:47:44 BRT 2012
% \usepackage[usenames,dvipsnames]{pstricks}
% \usepackage{epsfig}
% \usepackage{pst-grad} % For gradients
% \usepackage{pst-plot} % For axes
\scalebox{1} % Change this value to rescale the drawing.
{
\begin{pspicture}(0,-1.72)(13.22,1.7)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(0.0,0.7)(1.0,0.7)
\pscircle[linewidth=0.04,dimen=outer](1.2,0.7){0.2}
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(1.4,0.7)(2.8,0.7)
\psframe[linewidth=0.04,dimen=outer](4.0,1.1)(2.8,0.3)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(4.0,0.7)(5.0,0.7)
\psframe[linewidth=0.04,dimen=outer](6.2,1.1)(5.0,0.3)
\psframe[linewidth=0.04,dimen=outer](9.2,1.1)(8.0,0.3)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(9.2,0.7)(10.2,0.7)
\psframe[linewidth=0.04,dimen=outer](11.4,1.1)(10.2,0.3)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(6.2,0.7)(8.0,0.7)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{->}(11.4,0.7)(13.2,0.7)
\psline[linewidth=0.04cm,arrowsize=0.05291667cm 2.0,arrowlength=1.4,arrowinset=0.4]{<-}(1.2,0.5)(1.2,-1.7)
\psline[linewidth=0.04cm](1.2,-1.7)(12.4,-1.7)
\psline[linewidth=0.04cm](12.4,-1.7)(12.4,0.7)
\usefont{T1}{ppl}{m}{n}
\rput(0.45828125,1.01){$r(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(1.9445312,1.01){$\epsilon (t)$}
\usefont{T1}{ppl}{m}{n}
\rput(4.514531,1.01){$v(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(7.089375,1.01){$u(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(9.664532,1.01){$\omega(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(12.499375,1.01){$y(t)$}
\psline[linewidth=0.04cm](1.6,0.5)(1.8,0.5)
\psframe[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](6.6,1.7)(2.4,-0.3)
\psframe[linewidth=0.04,linestyle=dashed,dash=0.16cm 0.16cm,dimen=outer](11.8,1.7)(7.6,-0.3)
\usefont{T1}{ppl}{m}{n}
\rput(4.3345313,-0.59){C(z)}
\usefont{T1}{ppl}{m}{n}
\rput(9.744532,-0.59){G(z)}
\usefont{T1}{ppl}{m}{n}
\rput(3.3945312,0.69){$\gamma(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(10.794531,0.71){$\zeta(t)$}
\usefont{T1}{ppl}{m}{n}
\rput(5.594531,0.71){C'(z)}
\usefont{T1}{ppl}{m}{n}
\rput(8.604531,0.71){G'(z)}
\end{pspicture} 
}

\caption{Diagrama de blocos para um sistema não linear do tipo Wiener}
\label{fig:vrft_nl_wiener}
\end{figure}

O bloco linear da planta pode ser descrito como abaixo:

\begin{equation}
G'(z)=\frac{0.5}{z-0.9}
\label{eq:vrft_nl_wiener_g}
\end{equation}
a não linearidade presente na planta do sistema pode ser descrita como um polinômio de terceira ordem:

\begin{equation}
\zeta(\omega(t))=y(t)=1.5\omega(t)+0.2\omega^3(t)
\label{eq:vrft_nl_wiener_phi}
\end{equation}  
tem-se assim que a planta pode ser descrita pela concatenação dos blocos $G'(z)$ e $\zeta(t)$. Espera-se que o sistema
em malha fechada se comporte como $T_d(z)$:

\begin{equation}
T_d(z)=\frac{0.4}{z-0.6}
\label{eq:vrft_nl_wiener_m}
\end{equation}  
por $T_d(z)$ ser linear, o controlador ótimo $C_d(z)$ deve ser tal que possa cancelar o efeito não linear de
$\zeta(t)$. Em outras palavras, espera-se que o sistema em malha fechada possua o sinal $v(t)$ como em:

\begin{equation}
v(t)=r(t)-\omega(t)
\end{equation}
desta forma, o efeito não linear presente na planta seria anulado pelo controlador. Tem-se todavia, que o sistema
descrito na Figura \ref{fig:vrft_nl_wiener} se comporta como:

\begin{equation}
v(t)=\epsilon(t)\gamma (t)
\nonumber
\end{equation}
e sendo $\epsilon(t)$ descrito como:

\begin{equation}
\epsilon(t) = r(t) - y(t)
\nonumber
\end{equation}
pode-se obter então o relacionamento entre os sinais $\gamma(t) $ e $\zeta(t)$:

\begin{equation}
(r(t) - \omega(t) \zeta(t)) \gamma (t) = r(t) - \omega(t) 
\nonumber
\end{equation}
resultando em:

\begin{equation}
\gamma (t) = \frac{r(t)-\omega(t)}{r(t) - \omega(t)\zeta(t)} 
\label{eq:dbnarmac_ex_wiener_gamma}
\end{equation}

Percebe-se claramente que quando não há sinal de referência $r(t)$, ou seja

\begin{equation}
r(t) \equiv 0
\nonumber 
\end{equation}
o relacionamento entre os polinômios $\gamma(t) $ e $\zeta(t)$ fica simplificado a:

\begin{equation}
\gamma (t) = \frac{1}{\zeta(t)}
\nonumber 
\end{equation}

Determinar analiticamente a equação de $\gamma (t)$ como descrito em \eqref{eq:dbnarmac_ex_wiener_gamma} é uma tarefa um
tanto quando complexa. Por questões de simplificação optou-se por definir $\gamma(t)$ como sendo um outro polinômio,
assim como $\zeta(t)$ em \eqref{eq:vrft_nl_wiener_phi}. O polinômio $\gamma(t)$ escolhido para a identificação é:

\begin{equation}
\gamma (\epsilon(t))= v(t) = a_1\epsilon (t) + a_2 \epsilon ^2(t) +a_3 \epsilon ^3(t) +a_4 \epsilon ^4(t)
\label{eq:dbnarmax_ex_wiener_gamma_choosen}
\end{equation}  

Se nenhum dos blocos não lineares existissem no sistema, o controlador ideal poderia ser descrito pela equação
\eqref{eq:dbcd_perf_tracking_cd}, resultando em 

\begin{equation}
C_d(z)= \frac{0.8z-0.72}{z-1}
\label{eq:vrft_nl_wiener_cd}
\end{equation}
entretanto, o controlador ideal que leva o sistema a se comportar como definido por $T_d(z)$ é composto em parte por
\eqref{eq:vrft_nl_wiener_cd} acrescido do polinômio \eqref{eq:dbnarmax_ex_wiener_gamma_choosen}.

O controlador $C_d(z)$ possui uma integrador em sua estrutura. Para evitar problemas de seguimento de
referência optou-se por não identificar esta parte do controlador. Mantendo o denominador como um integrador
e identificando apenas o numerador. 

Fazendo-se as substituições necessárias, chega-se a expressão do sinal de saída do controlador que se quer identificar:

\begin{align}\nonumber
u(t) =&  \theta_1 \epsilon (t)+ \theta_2 \epsilon ^2(t)+ \theta_3 \epsilon^3(t)+ \theta_4 \epsilon^4(t)+\\
& \theta_5 \epsilon(t-1)+ \theta_6 \epsilon^2(t-1)+  \theta_7 \epsilon^3(t-1)+ \theta_8 \epsilon^4(t-1)
\label{eq:dbnarmax_ex_wiener_controller}
\end{align}

Observa-se que $u(t)$ em \eqref{eq:dbnarmax_ex_wiener_controller} é um modelo NARMAX polinomial. Foram realizados 100
experimentos de Monte Carlo adicionando um ruído com $\sigma_e^2=0.05$ e utilizando o algoritmo para identificação de
modelos NARMAX em conjunto com o procedimento de referência virtual para gerar os sinais $r(t)$ e $\epsilon(t)$ e a
média das estimativas obtidas foi de:

\begin{equation}
\theta_{\text{média}} =\begin{bmatrix}
0.44717 \\ 2.0216\times10^{-3} \\ -6.5181\times10^{-4} \\ -1.608\times10^{-5} \\ -0.40435 \\ -1.6163\times10^{-3} \\
6.1265\times10^{-4}\\ 1.469\times10^{-5} 
\end{bmatrix}^T
\nonumber
\end{equation}
%com uma matriz de covariância de:
%
%\begin{equation}
%\theta_{\text{Covariância}} =\begin{bmatrix}
%5.2065e-06 & 	 -9.7986e-08 & 	 -1.9078e-08 & 	 -3.2055e-10 & 	 -3.6186e-06 & 	 1.2798e-07 & 	 5.9285e-09 & 	 -2.0474e-10  \\ 
%-9.7986e-08 & 	 5.5494e-08 & 	 -5.4726e-10 & 	 -1.5158e-10 & 	 1.0123e-07 & 	 -4.4708e-08 & 	 3.9962e-10 & 	 1.2237e-10  \\ 
%-1.9078e-08 & 	 -5.4726e-10 & 	 2.1459e-10 & 	 9.3647e-12 & 	 4.4485e-09 & 	 3.1849e-10 & 	 -2.5329e-11 & 	 -2.0593e-12  \\ 
%-3.2055e-10 & 	 -1.5158e-10 & 	 9.3647e-12 & 	 8.0071e-13 & 	 -1.9028e-10 & 	 8.5314e-11 & 	 -1.6175e-12 & 	 -2.9308e-13  \\ 
%-3.6186e-06 & 	 1.0123e-07 & 	 4.4485e-09 & 	 -1.9028e-10 & 	 5.0042e-06 & 	 -8.9899e-08 & 	 -1.6759e-08 & 	 -1.5359e-10  \\ 
%1.2798e-07 & 	 -4.4708e-08 & 	 3.1849e-10 & 	 8.5314e-11 & 	 -8.9899e-08 & 	 6.9081e-08 & 	 -7.8269e-10 & 	 -2.0938e-10  \\ 
%5.9285e-09 & 	 3.9962e-10 & 	 -2.5329e-11 & 	 -1.6175e-12 & 	 -1.6759e-08 & 	 -7.8269e-10 & 	 1.5274e-10 & 	 7.6667e-12  \\ 
%-2.0474e-10 & 	 1.2237e-10 & 	 -2.0593e-12 & 	 -2.9308e-13 & 	 -1.5359e-10 & 	 -2.0938e-10 & 	 7.6667e-12 & 	 9.0946e-13  \\ 
%\end{bmatrix}
%\nonumber
%\end{equation}


O custo entre os sinais de saída do sistema obtido e o sistema esperado $T_d(z)$ foi de  $J_{y}(\theta)=
0.3820$ e o custo dos sinais de saída do controlador ($u(t)$) esperado e obtido foi de $J_{VR}=1.0119$.

Como $\gamma(t)$ escolhido em \eqref{eq:dbnarmax_ex_wiener_gamma_choosen} é apenas uma aproximação do que esperava-se em
\eqref{eq:dbnarmac_ex_wiener_gamma}, sabe-se que a classe de modelos escolhida para o controlador não consegue
representar a totalidade do controlador ideal $C_d(t)$. Desta forma é esperado que a identificação não consiga atingir
a totalidade da função $T_d(z)$ inicialmente escolhida. Para as estimativas foram utilizados sinais de entrada do tipo
PRBS com 127 pontos para a excitação da planta.

Na Figura (\ref{fig:vrft_nl_wiener_step}) é apresentado um comparativo entre o sinal de saída do sistema
$T_d(z)$ quando submetido a um degrau unitário e o sinal do sistema real quando o controlador identificado é
aplicado sobre a planta em malha fechada.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_nl_wiener_step.eps}
	\caption{Comparativo da resposta à um degrau unitário do sistema desejado $T_d(t)$  o sistema real quando o controlador
	controlador não linear representado por um modelo NARMAX polinomial é inserido na planta.}
	\label{fig:vrft_nl_wiener_step}
\end{figure}

Na Figura (\ref{fig:vrft_nl_wiener_vw_step}) é apresentado o comportamento dos sinais de saída e entrada das
não linearidades $\gamma(\epsilon(t))$ e $\zeta(\omega(t))$ respectivamente.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_nl_wiener_vw_step.eps}
	\caption{Sinais $v(t)$ e $\omega(t)$ do sistema apresentado na Figura \ref{fig:vrft_nl_wiener} quando este é
	excitado por um degrau unitário.}
	\label{fig:vrft_nl_wiener_vw_step}
\end{figure}

A relação entre os sinais $v(t)$ e $\omega(t)$ é apresentado na Figura (\ref{fig:vrft_nl_wiener_vw}).
Observa-se que a relação destes sinais é praticamente linear, garantido desta forma que a aproximação feita em
\eqref{eq:dbnarmax_ex_wiener_gamma_choosen} foi suficiente para representar com acuracidade o que era esperado para
$\gamma(t)$ em \eqref{eq:dbnarmac_ex_wiener_gamma}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_nl_wiener_vw.eps}
	\caption{relação entre os sinais $v(t)$ e $\omega(t)$ quando o sistema é alimentado por um degrau unitário}
	\label{fig:vrft_nl_wiener_vw}
\end{figure}

%===============================================================================
\subsection{Não linearidades dinâmicas}
\label{sec:dbnarmax_nl_dinamic}
%===============================================================================

%TODO: escrever isso melhor

%===============================================================================
\subsubsection{Controlador ideal sendo representado pela classe de modelos}
\label{sec:dbnarmax_nl_dinamic_c_match}
%===============================================================================

Considere o sistema não linear descrito por:

\begin{equation}
y(t)=\frac{0.5u(t-1)y(t-1)+u(t-1)}{1+0.25y^2(t-2)}
\label{eq:vrft_nl_dinamic_ex1_y}
\end{equation}

Deseja-se que em malha fechada seu comportamento seja linear como em:

\begin{equation}
T_d(z)=\frac{0.4}{z-0.6}
\label{eq:vrft_nl_dinamic_ex1_mz}
\end{equation}

A equação \eqref{eq:vrft_nl_dinamic_ex1_mz} pode ser reescrita em função do tempo como em:

\begin{equation}
y(t)=0.4r(t-1)+0.6y(t-1)
\label{eq:vrft_nl_dinamic_ex1_mt}
\end{equation}

Ao igualar a equação \eqref{eq:vrft_nl_dinamic_ex1_y} com \eqref{eq:vrft_nl_dinamic_ex1_mt} e isolar o
sinal $u(t)$ tem-se a equação que descreve o comportamento do controlador que levará a planta a ter o
comportamento descrito por $T_d(z)$ em malha fechada. Obtém-se desta forma um controlador ideal $C_d(z)$ descrito como
em:

\begin{equation}
u(t)=\frac{0.4r(t)+0.6y(t)+0.1y^2(t-1)r(t)+0.15y(t)y^2(t-1)}{1+0.5y(t)}
\label{eq:vrft_nl_dinamic_ex1_cd}
\end{equation}

Optou-se por uma classe de modelos que consegue representar a totalidade das dinâmicas presentes em $C_d(z)$:

\begin{equation}
u(t)=\frac{\theta_1 r(t)+ \theta_2 y(t)+ \theta_3 y^2(t-1)r(t)+ \theta_4 y(t)y^2(t-1)}{1+ \theta_5 y(t)}
\label{eq:vrft_nl_dinamic_ex1_c}
\end{equation}

Utilizando um sinal PRBS de $N=254$ e o método de referência virtual para gerar os sinais $r(t)$ e
$\epsilon(t)$. Adicionando-se um ruído de variância $\sigma_e^2 = 0.005$ à saída do sistema, a média das estimativas
para 100 experimentos de Monte Carlo foi de:

\begin{equation}
\theta_{\text{média}}=\begin{bmatrix}
0.4000 & 0.5999 & 0.1001 & 0.1501 & 0.5000
\end{bmatrix}
\nonumber
\end{equation}
a matriz de covariância obtida neste experimento é descrita por:

\begin{equation}
\theta_{\text{Covariância}}=1.0\times 10^{-6}\begin{bmatrix}
 0.0498 &  0.0585 & -0.0353 & -0.0362 & -0.0018 \\
 0.0585 &  0.4714 & -0.0449 & -0.3690 &  0.0057 \\
-0.0353 & -0.0449 &  0.0581 &  0.0745 & -0.0040 \\
-0.0362 & -0.3690 &  0.0745 &  0.4647 & -0.0070 \\
-0.0018 &  0.0057 & -0.0040 & -0.0070 &  0.0911
\end{bmatrix}
\nonumber
\end{equation}

Simulando o sistema com o controlador obtido pela média das estimativas e o sistema em malha fechada
desejado, o erro observado para um sinal de entrada do tipo degrau unitário é apresentado na Figura
\ref{fig:vrft_nl_dynamic_step_erro}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_nl_dynamic_erro_step.eps}
	\caption{Erro entre o a resposta esperada e a obtida para o sistema quando submetido a uma entrada do tipo degrau
	unitário.}
	\label{fig:vrft_nl_dynamic_step_erro}
\end{figure}

A fim de ilustrar as estimativas obtidas pelo método, na Figura \ref{fig:vrft_nl_dynamic_t1_t2} são
apresentados as estimativas para os 100 experimentos realizados, além da elipse de confiança de $\chi^2=95\%$
para os parâmetros $\theta_1$ e $\theta_2$.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vrft_nl_dynamic_t1_t2.eps}
	\caption{100 experimentos de Monte Carlo das variáveis $\theta_1$ e $\theta_2$}
	\label{fig:vrft_nl_dynamic_t1_t2}
\end{figure}

O custo $J_{VR}=2.7291\times10{-8}$ foi obtido utilizando-se os sinais de saída do controlador obtido e
esperado. Já o custo entre os sinais de saída do sistema em malha fechada estimado e desejado foi de
$J_{y}=0.0033$.

Com o intuito de demonstrar o efeito do ruído sobre as estimativas obtidas o ruído foi aumentado em $4\times$ para
$\sigma_e^2 = 0.02$. Obteve-se desta forma os seguintes resultados paras as estimativas:

\begin{equation}
\theta_{\text{média}}=\begin{bmatrix}
0.3999 & 0.5996 & 0.1001 & 0.1502 & 0.4999
\end{bmatrix}
\nonumber
\end{equation}

\begin{equation}
\theta_{\text{Covariância}}=1.0\times 10^{-5}\begin{bmatrix}
    0.1061 &  0.1207 & -0.0894 & -0.1185 & -0.0310 \\
    0.1207 &  0.7122 & -0.1048 & -0.5357 &  0.0038 \\
   -0.0894 & -0.1048 &  0.1344 &  0.1972 & -0.0033 \\
   -0.1185 & -0.5357 &  0.1972 &  0.7523 & -0.0571 \\ 
   -0.0310 &  0.0038 & -0.0033 & -0.0571 &  0.1355
\end{bmatrix}
\nonumber
\end{equation}

Com os custos de $J_{VR}=1.0326\times10{-7}$ e $J_{y}=0.0054$, corroborando para o fato de que os custos não
foram significativamente afetados pelo aumento do ruído. Observa-se um aumento do erro de variância, pois a matriz de
covariância que era da ordem de $\times10^{-6}$ passou para a ordem de $\times10^{-5}$, entretanto o valor médio das
estimativas permaneceu praticamente inalterado, corroborando pela não existência de erro de polarização.

%===============================================================================
\subsubsection{Controlador ideal sendo representado pela classe de modelos 2}
\label{sec:dbnarmax_nl_dinamic_c_match2}
%===============================================================================

%===============================================================================
\subsubsection{Controlador não sendo representado pelo modelo}
\label{sec:dbnarmax_nl_dinamic_c_not_match}
%===============================================================================

Neste exemplo será abordado o caso onde o controlador $C(z, \theta) \notin \mathcal{C}$. Fazendo com que o sistema em
malha fechada não consiga ter a dinâmica esperada. Considere a planta não linear descrita por:

\begin{equation}
y(t)=\frac{0.5u(t-1)y(t-1)+u(t-1)}{1+0.25y^2(t-2)}
\label{eq:vrft_nl_dinamic_ex3_y}
\end{equation}

Deseja-se que em malha fechada seu comportamento seja linear como em:

\begin{equation}
T_d(z)=\frac{0.4}{z-0.6}
\label{eq:vrft_nl_dinamic_ex3_mz}
\end{equation}

A equação \eqref{eq:vrft_nl_dinamic_ex3_mz} pode ser reescrita em função do tempo como em:

\begin{equation}
y(t)=0.4r(t-1)+0.6y(t-1)
\label{eq:vrft_nl_dinamic_ex3_mt}
\end{equation}

Ao igualar a equação \eqref{eq:vrft_nl_dinamic_ex3_y} com \eqref{eq:vrft_nl_dinamic_ex3_mt} e isolar o
sinal $u(t)$ tem-se a equação que descreve o comportamento do controlador que levará a planta a ter o
comportamento descrito por $T_d(z)$ em malha fechada. Obtém-se desta forma um controlador ideal como em:

\begin{equation}
u(t)=\frac{0.4r(t)+0.6y(t)+0.1y^2(t-1)r(t)+0.15y(t)y^2(t-1)}{1+0.5y(t)}
\label{eq:vrft_nl_dinamic_ex3_cd}
\end{equation}

No exemplo apresentado na seção \ref{sec:dbnarmax_nl_dinamic_c_match} foi apresentada a simulação para quando o controlador
ótimo consegue ser descrito pelo modelo escolhido para representa-lo. Neste exemplo deseja-se o oposto: que a classe de
modelos escolhida para o controlador não consiga representar completamente \eqref{eq:vrft_nl_dinamic_ex3_cd}. Para isso
escolheu-se a seguinte classe de modelos:

\begin{equation}
u(t)=\frac{\theta_1 r(t)+ \theta_2 y(t)+ \theta_3 r(t)y(t-1)+ \theta_4 y(t-1)y(t)}{1+ \theta_5 y(t)}
\label{eq:vrft_nl_dinamic_ex3_c}
\end{equation}

Para as simulações foi adicionado um ruído com $\sigma_e^2 = 0.05$ e foram realizados 100 experimentos de Monte Carlo
onde obteve-se as seguintes estimativas:

\begin{equation}
\theta_{\text{média}}=\begin{bmatrix}
0.4696 & 0.7011 & 0.0083 & 0.0063 & 0.5013
\end{bmatrix}
\label{eq:vr_rational_ex3_theta}
\end{equation}
com uma covariância de:

\begin{equation}
\theta_{\text{Covariância}}=1.0\times 10^{-4}\begin{bmatrix}
    0.0278 &  0.0396 &  0.0035 &  0.0146 & -0.0137 \\
    0.0396 &  0.3328 &  0.0066 & -0.1651 &  0.0063 \\
    0.0035 &  0.0066 &  0.0382 &  0.0688 & -0.0119 \\
    0.0146 & -0.1651 &  0.0688 &  0.4130 & -0.0562 \\
   -0.0137 &  0.0063 & -0.0119 & -0.0562 &  0.0646
\end{bmatrix}
\nonumber
\end{equation}

Obtém-se um custo para o comportamento do sistema em malha fechada de  $J_{y}=1.0999$. Na Figura
\ref{fig:vr_rational_notinclass_ex3_step} é apresentado a resposta do sistema em malha fechada quando submetido a um
degrau unitário para o sistema desejado e para o sistema obtido com o controlador parametrizado por
\eqref{eq:vr_rational_ex3_theta}.

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vr_rational_notinclass_ex3_step.eps}
	\caption{Exemplo onde $C_d(z) \notin C(z,\theta)$: Resposta do sistema ao degrau unitário para o sistema desejado
	$T_d(z)$ e o sistema quando o controlador parametrizado por $\theta$ como descrito em
	\eqref{eq:vr_rational_ex3_theta}. Onde $T_d(t)$ é a resposta temporal para o comportamento esperado do sistema e
	$T(t)$ é o comportamento temporal para o sistema quando está utilizando o controlador identificado.}
	\label{fig:vr_rational_notinclass_ex3_step}
\end{figure}

Na Figura \ref{fig:vr_rational_notinclass_ex3_error} é apresentado o erro entre as respostas ao degrau
unitário apresentado na Figura \ref{fig:vr_rational_notinclass_ex3_step}. 

\begin{figure}[htbp] 
	\center 
	\includegraphics[width=0.95\columnwidth]{figures/vr_rational_notinclass_ex3_error.eps}
	\caption{Exemplo onde $C_d(z) \notin C(z,\theta)$: Erro entre o comportamento do sistema em malha fechada e o
	comportamento em malha fechada desejado.}
	\label{fig:vr_rational_notinclass_ex3_error}
\end{figure}

Observa-se que mesmo quando não há uma completa capacidade da classe de modelos em representar o controlador ideal, o
erro da estimativa é relativamente baixo, mas não insignificante, ficando em aproximadamente 6\% em regime e chegando a
atingir quase 20\% durante o transitório. Em contrapartida, quando há capacidade do controlador ideal ser representado
pela classe do controlador, o erro em regime ficou em 0.02\% como apresentado na Figura
\ref{fig:vrft_nl_dynamic_step_erro}.

